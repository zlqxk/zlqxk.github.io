(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{8420:function(n,e,t){"use strict";t.d(e,{Z:function(){return _}});var o=t(6311),s=t(2472),a=t.n(s),r=t(9980),i=t.n(r),c=t(637),d=new(i())({highlight:function(n,e){var t=d.utils.escapeHtml(n);return e&&c.Z.getLanguage(e)&&(t=c.Z.highlight(e,n,!0).value),'<pre class="hljs"><code>'.concat(t,"</code></pre>")}}),p=d,u=t(2809),m=t(7294),l=t(3518),w=t.n(l),h=t(4184),b=t.n(h),f=t(5893),j=function(n){var e=n.visible,t=n.onClose,o=n.src;return(0,f.jsx)("div",{className:b()(w().imgPreview,(0,u.Z)({},w().visible,e)),onClick:t,children:(0,f.jsx)("img",{src:o})})},k=t(9008),_=(t(7460),function(n){var e=n.content,t=n.pageInfo,s=function(){var n=(0,m.useState)(!1),e=n[0],t=n[1],o=(0,m.useState)(""),s=o[0],a=o[1],r=(0,m.useRef)(null);return(0,m.useEffect)((function(){var n,e,o=null!==(n=null===(e=r.current)||void 0===e?void 0:e.getElementsByTagName("img"))&&void 0!==n?n:[];Array.from(o).forEach((function(n){n.onclick=function(n){n.target instanceof HTMLImageElement&&a(n.target.src),t(!0)}}))}),[]),[r,e,s,t]}(),r=(0,o.Z)(s,4),i=r[0],c=r[1],d=r[2],u=r[3];return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(k.default,{children:[(0,f.jsx)("title",{children:t.title}),(0,f.jsx)("meta",{name:"description",content:t.subtitle})]}),(0,f.jsx)(j,{visible:c,src:d,onClose:function(){return u(!1)}}),(0,f.jsx)("article",{ref:i,className:a().article,dangerouslySetInnerHTML:{__html:p.render(e)}})]})})},5657:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return a}});t(7294);var o=t(8420),s=t(5893),a=function(){return(0,s.jsx)(o.Z,{content:"# webpack \u4f18\u5316\u6307\u5357\n\n6 \u6708 6, 2022 \u2022 \u2615\ufe0f\u2615\ufe0f\u2615\ufe0f 30 min read\n\n\u5728 webpack4 \u4ee5\u540e\uff0c\u914d\u7f6e\u4e00\u4e2a\u7b80\u5355\u7684\u6253\u5305\u73af\u5883\u7684\u6210\u672c\u5df2\u7ecf\u53d8\u5f97\u975e\u5e38\u4f4e\uff0c\u5e76\u4e14\u4f1a\u6839\u636e\u4f60\u9009\u62e9\u7684 mode \u6765\u6267\u884c\u4e0d\u540c\u7684\u4f18\u5316\uff0c\u4e0d\u8fc7\u6240\u6709\u7684\u4f18\u5316\u8fd8\u662f\u53ef\u4ee5\u624b\u52a8\u914d\u7f6e\u548c\u91cd\u5199\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u4e86\u89e3\u5176\u4e2d\u4e00\u4e9b\u673a\u5236\u7684\u8bdd\uff0c\u5f88\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u8d1f\u4f18\u5316\u7684\u60c5\u51b5\uff0c\u672c\u6587\u5c31\u6765\u8bb0\u5f55\u4e00\u4e0b webpack \u90fd\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u54ea\u4e9b\u4f18\u5316\u6253\u5305\u4ea7\u7269\u7684\u80fd\u529b\u3002\n\n## 1\u3001\u4ee3\u7801\u62c6\u5206\n\n\u5728\u8fd9\u4e4b\u524d\uff0c\u6211\u4eec\u5047\u8bbe\u6709\u4e00\u4e2a\u7b80\u5355\u7684 webpack \u914d\u7f6e\u548c\u4e24\u4e2a js \u6587\u4ef6\u3002\n\n```ts\n// webpack.config.js\nconst path = require('path')\n\nmodule.exports = {\n  entry: './src/index.js',\n  mode: 'development',\n\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n}\n\n// src/index.js\nimport _ from 'lodash'\nimport './module'\n\nconsole.log(_.join(['Another', 'module', 'loaded!'], ' '))\n\n// src/module.js\nimport _ from 'lodash'\n\nconsole.log(_.join(['Another', 'module', 'loaded!'], ' '))\n```\n\n\u4e0a\u8ff0\u7684\u914d\u7f6e\u4f1a\u901a\u8fc7 /src/index.js \u4f5c\u4e3a\u5165\u53e3\uff0c\u6536\u96c6\u6240\u6709\u7684\u4f9d\u8d56\u5e76\u4e14\u6253\u5305\u5728\u4e00\u4e2a main.js \u7684\u6587\u4ef6\u4e2d\u3002\n\n\u4f46\u662f\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4e0d\u53ef\u80fd\u5c06\u6240\u6709\u6a21\u5757\u6253\u5305\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u6700\u540e\u7684\u4ea7\u7269\u8fc7\u5927\u3002\u901a\u5e38\u6211\u4eec\u4f1a\u4ee3\u7801\u62c6\u5206\u5230\u4e0d\u540c\u7684 bundle\uff0c\u7136\u540e\u53ef\u4ee5\u6309\u9700\u6216\u8005\u5e76\u884c\u52a0\u8f7d\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5982\u679c\u4f7f\u7528\u7684\u5408\u7406\u4f1a\u6781\u5927\u7684\u51cf\u5c11\u52a0\u8f7d\u65f6\u95f4\u3002\u5e38\u7528\u7684\u4ee3\u7801\u5206\u79bb\u7684\u65b9\u6cd5\u6709\u4e24\u79cd\uff1a\n\n- \u591a\u5165\u53e3\uff1a\u4f7f\u7528 entry \u914d\u7f6e\u624b\u52a8\u5730\u5206\u79bb\u4ee3\u7801\u3002\n\n- \u52a8\u6001\u5bfc\u5165\uff1a\u901a\u8fc7\u6a21\u5757\u7684\u5185\u8054\u51fd\u6570\u8c03\u7528\u6765\u5206\u79bb\u4ee3\u7801\u3002\n\n### \u591a\u5165\u53e3\n\n\u591a\u5165\u53e3\u7684\u6a21\u5f0f\u9700\u8981\u6211\u4eec\u81ea\u5df1\u624b\u52a8\u6307\u5b9a\u54ea\u4e9b\u6a21\u5757\u662f\u8981\u62c6\u5206\u7684\uff0c\u7136\u540e\u5f15\u5165\u65f6\u518d\u624b\u52a8\u5f15\u5165\u8fd9\u4e9b\u62c6\u5206\u597d\u7684\u6a21\u5757\uff0c\u8ba9\u6211\u4eec\u4fee\u6539\u4e0b webpack \u7684\u914d\u7f6e\u770b\u4e0b\u5982\u4f55\u901a\u8fc7\u591a\u5165\u53e3\u6765\u62c6\u5206 bundle \uff08\u4fee\u6539\u540e index.js \u4e2d\u5c31\u4e0d\u9700\u8981\u5f15\u7528 module.js \u4e86\uff09\u3002\n\n```ts\nconst path = require('path')\n\nmodule.exports = {\n  mode: 'development',\n  entry: {\n    index: './src/index.js',\n    another: './src/module.js',\n  },\n  output: {\n    filename: '[name].bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n}\n```\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u62c6\u5206\u51fa\u4e24\u4e2a\u6a21\u5757\u4e86\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a\n\n- \u5982\u679c\u591a\u4e2a\u6a21\u5757\u4e4b\u95f4\u6709\u91cd\u590d\u7684\u4f9d\u8d56\uff0c\u90a3\u8fd9\u4e9b\u7684\u4f9d\u8d56\u4f1a\u88ab\u91cd\u590d\u6253\u5305\u5230\u5404\u4e2a bundle \u4e2d\n\n- \u8fd9\u79cd\u65b9\u6cd5\u4e0d\u591f\u7075\u6d3b\uff0c\u5e76\u4e14\u4e0d\u80fd\u52a8\u6001\u5730\u5c06\u6838\u5fc3\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u4e2d\u7684\u4ee3\u7801\u62c6\u5206\u51fa\u6765\u3002\n\n\u7b2c\u4e8c\u6761\u4e0d\u7528\u8fc7\u591a\u89e3\u91ca\uff0c\u7b2c\u4e00\u6761\u7684\u95ee\u9898\u662f\u5f88\u4e25\u91cd\uff0c\u5982\u679c\u6211\u4e24\u4e2a\u6a21\u5757\u90fd\u7528\u5230\u4e86 lodash\uff0c\u90a3 lodash \u8fd9\u4e2a\u4f9d\u8d56\u4f1a\u88ab\u6253\u5305\u4e24\u6b21\uff0c\u4f8b\u5982\u4e0b\u56fe index.bundle.js \u548c another.bundle.js \u7684\u4f53\u79ef\u90fd\u8fbe\u5230\u4e86 554kiB\u3002\n\n![webpack_1](/webpack-optimization/webpack_1.jpg)\n\n\u8fd9\u663e\u7136\u662f\u4e0d\u80fd\u88ab\u63a5\u53d7\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6253\u5305\u914d\u7f6e\u4e2d\u6307\u5b9a\u54ea\u4e9b\u662f\u516c\u5171\u4f9d\u8d56\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n```ts\nconst path = require('path')\n\nmodule.exports = {\n  mode: 'development',\n  entry: {\n    index: {\n      import: './src/index.js',\n      // \u5173\u952e\u4ee3\u7801\n      dependOn: 'shared',\n    },\n    another: {\n      import: './src/module.js',\n      // \u5173\u952e\u4ee3\u7801\n      dependOn: 'shared',\n    },\n    // \u5173\u952e\u4ee3\u7801\n    shared: 'lodash',\n  },\n  output: {\n    filename: '[name].bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n}\n```\n\n\u901a\u8fc7\u4e0a\u8ff0\u914d\u7f6e\u6253\u5305\u53ef\u4ee5\u770b\u5230\u62c6\u5206\u51fa\u4e86\u4e00\u4e2a shared \u7684 bundle\uff0c\u800c\u5269\u4f59\u7684\u4e24\u4e2a\u6a21\u5757\u7684\u4f53\u79ef\u4e5f\u964d\u56de\u4e86 1.6k\u3002\n\n![webpack_2](/webpack-optimization/webpack_2.png)\n\n\u867d\u7136\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5b9e\u73b0\u4ee3\u7801\u7684\u62c6\u5206\uff0c\u4f46\u662f\u9700\u8981\u6211\u4eec\u624b\u52a8\u53bb\u6307\u5b9a\u63d0\u53d6\u54ea\u4e9b\u6a21\u5757\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u6211\u4eec\u671f\u671b\u7684\u6548\u679c\uff0c\u90a3\u6709\u6ca1\u6709\u4e00\u79cd\u65b9\u5f0f\u53ef\u4ee5\u8ba9 webpack \u81ea\u52a8\u63d0\u53d6\u516c\u5171\u7684\u6a21\u5757\u5462\uff1f\n\n> SplitChunksPlugin \u63d2\u4ef6\u53ef\u4ee5\u5c06\u516c\u5171\u7684\u4f9d\u8d56\u6a21\u5757\u63d0\u53d6\u5230\u5df2\u6709\u7684\u5165\u53e3 chunk \u4e2d\uff0c\u6216\u8005\u63d0\u53d6\u5230\u4e00\u4e2a\u65b0\u751f\u6210\u7684 chunk\u3002\n\n```ts\nconst path = require('path')\n\nmodule.exports = {\n  mode: 'development',\n  entry: {\n    index: './src/index.js',\n    another: './src/module.js',\n  },\n  output: {\n    filename: '[name].bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n  // \u5173\u952e\u4ee3\u7801\n  optimization: {\n    splitChunks: {\n      chunks: 'all',\n    },\n  },\n}\n```\n\n\u901a\u8fc7\u4e0a\u8ff0\u914d\u7f6e\u6253\u5305\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0clodash \u7684\u4f9d\u8d56\u88ab\u5355\u72ec\u62bd\u79bb\u6210\u4e86\u4e00\u4e2a bundle\u3002\n\n![webpack_3](/webpack-optimization/webpack_3.jpg)\n\n\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6211\u4eec\u5c31\u53ef\u4ee5\u4e0d\u7528\u624b\u52a8\u7684\u6307\u5b9a\u8981\u63d0\u53d6\u54ea\u4e9b\u516c\u5171\u4f9d\u8d56\u4e86\u3002\n\n## \u4ee3\u7801\u62c6\u5206 - \u52a8\u6001\u5bfc\u5165\n\n\u5f53\u6d89\u53ca\u5230\u52a8\u6001\u4ee3\u7801\u62c6\u5206\u65f6\uff0cwebpack \u63d0\u4f9b\u4e86\u4e24\u4e2a\u7c7b\u4f3c\u7684\u6280\u672f\u3002\u7b2c\u4e00\u79cd\uff0c\u4e5f\u662f\u63a8\u8350\u9009\u62e9\u7684\u65b9\u5f0f\u662f\uff0c\u4f7f\u7528\u7b26\u5408 ECMAScript \u63d0\u6848 \u7684 [import()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import) \u8bed\u6cd5 \u6765\u5b9e\u73b0\u52a8\u6001\u5bfc\u5165\u3002\u7b2c\u4e8c\u79cd\uff0c\u5219\u662f webpack \u7684\u9057\u7559\u529f\u80fd\uff0c\u4f7f\u7528 webpack \u7279\u5b9a\u7684 require.ensure\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u5173\u5fc3\u7b2c\u4e00\u79cd\u3002\n\n\u8ba9\u6211\u4eec\u5c06\u914d\u7f6e\u6062\u590d\u539f\u6765\u7684\u6a21\u6837\u3002\n\n```ts\n// webpack.config.js\nconst path = require('path')\n\nmodule.exports = {\n  entry: './src/index.js',\n  mode: 'development',\n\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n}\n```\n\n\u4fee\u6539\u4e00\u4e0b src/index.js \u5f15\u5165\u5176\u4ed6\u6a21\u5757\u7684\u65b9\u5f0f\u3002\n\n```ts\nimport('lodash').then(({ default: _ }) => {\n  console.log(_.join(['Another', 'module', 'loaded!'], ' '))\n})\n\nimport('./module')\n```\n\n\u7ecf\u8fc7\u4e0a\u8ff0\u4fee\u6539\u540e\u6253\u5305\u53ef\u4ee5\u770b\u5230\uff0c\u5df2\u7ecf\u62c6\u5206\u51fa\u4e86\u4e09\u4e2a bundles\u3002\n\n![webpack_4](/webpack-optimization/webpack_4.jpg)\n\n\u800c\u4e14\u4e0e\u591a\u5165\u53e3\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u591a\u5165\u53e3\u7684\u6253\u5305\u65b9\u5f0f\u9700\u8981\u5c06\u62c6\u5206\u540e\u7684 js \u90fd\u5f15\u5165\u7684 html \u4e2d\uff0c\u4f46\u662f\u52a8\u6001\u5f15\u5165\u6211\u4eec\u53ea\u9700\u8981\u5f15\u5165 main.js \u5373\u53ef\uff0c\u539f\u56e0\u662f main.js \u4f1a\u52a8\u6001\u521b\u5efa\u4e24\u4e2a script \u6807\u7b7e\u53bb\u5f15\u5165\u62c6\u5206\u7684 bundle\u3002\n\n![webpack_5](/webpack-optimization/webpack_5.jpg)\n\n\u7b49\u52a8\u6001\u521b\u5efa\u7684 js \u52a0\u8f7d\u5b8c\u6210\u540e\u4f1a\u518d\u5220\u9664\u8fd9\u4e2a script \u6807\u7b7e\u3002\n\n![webpack_6](/webpack-optimization/webpack_6.jpg)\n\n\u591a\u5165\u53e3\u548c\u52a8\u6001\u5f15\u5165\u90fd\u53ef\u4ee5\u5e2e\u6211\u4eec\u505a\u4ee3\u7801\u62c6\u5206\uff0c\u4f46\u4ed6\u4eec\u4f7f\u7528\u7684\u573a\u666f\u662f\u4e0d\u540c\u7684\u3002\u591a\u5165\u53e3\u5f80\u5f80\u662f\u7528\u5728\u7ea6\u5b9a\u5f0f\u8def\u7531\u7684\u573a\u666f\uff0c\u4f8b\u5982 src \u4e0b\u7684\u67d0\u4e2a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u7ec4\u6210\u8fd9\u4e2a\u5e94\u7528\u7684\u8def\u7531\uff0c\u7136\u540e\u5728 webpack \u4e2d\u901a\u8fc7\u6587\u4ef6\u8bfb\u53d6\u83b7\u53d6\u8fd9\u4e9b\u6587\u4ef6\u5217\u8868\u5f53\u505a\u6253\u5305\u5165\u53e3\u3002\u52a8\u6001\u5bfc\u5165\u901a\u5e38\u662f\u7528\u5728\u6211\u4eec\u8981\u81ea\u5df1\u624b\u52a8\u63a7\u5236\u8981\u62c6\u5206\u54ea\u4e9b\u6a21\u5757\u7684\u573a\u666f\u3002\n\n## 2\u3001Tree Shaking\n\n> tree shaking \u662f\u4e00\u4e2a\u672f\u8bed\uff0c\u901a\u5e38\u7528\u4e8e\u63cf\u8ff0\u79fb\u9664 JavaScript \u4e0a\u4e0b\u6587\u4e2d\u7684\u672a\u5f15\u7528\u4ee3\u7801(dead-code)\u3002\u5b83\u4f9d\u8d56\u4e8e ES2015 \u6a21\u5757\u8bed\u6cd5\u7684 \u9759\u6001\u7ed3\u6784 \u7279\u6027\uff0c\u4f8b\u5982 import \u548c export\u3002\u8fd9\u4e2a\u672f\u8bed\u548c\u6982\u5ff5\u5b9e\u9645\u4e0a\u662f\u7531 ES2015 \u6a21\u5757\u6253\u5305\u5de5\u5177 rollup \u666e\u53ca\u8d77\u6765\u7684\u3002\n\nwebpack \u7684 tree-shaking \u548c\u5176\u4ed6\u7684\u6253\u5305\u5de5\u5177\u76f8\u6bd4\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u5730\u65b9\uff0c\u90a3\u5c31\u662f sideEffects\uff0c\u5728 package.json \u4e2d\u6dfb\u52a0\u8fd9\u4e2a\u914d\u7f6e\u53ef\u4ee5\u6307\u5b9a\u4f60\u5f53\u524d\u7684\u6a21\u5757\u662f\u5426\u5b58\u5728\u526f\u4f5c\u7528\u3002\u5728\u4e00\u4e2a\u7eaf\u7cb9\u7684 ESM \u6a21\u5757\u4e16\u754c\u4e2d\uff0c\u5f88\u5bb9\u6613\u8bc6\u522b\u51fa\u54ea\u4e9b\u6587\u4ef6\u6709\u526f\u4f5c\u7528\uff0c\u7136\u800c\uff0c\u6211\u4eec\u7684\u9879\u76ee\u65e0\u6cd5\u8fbe\u5230\u8fd9\u79cd\u7eaf\u5ea6\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u53bb\u624b\u52a8\u6307\u5b9a\u54ea\u4e9b\u6a21\u5757\u662f\u662f\u5426\u5b58\u5728\u526f\u4f5c\u7528\u3002\n\n\u5047\u8bbe\u6211\u4eec\u6709\u4ee5\u4e0b\u914d\u7f6e\u548c\u6587\u4ef6\uff0cwebpack config \u5c31\u662f\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u751f\u4ea7\u73af\u5883\u914d\u7f6e\uff0cindex.js \u5f15\u7528\u4e86 module \u91cc\u7684 random \u65b9\u6cd5\u3002\n\n```ts\n// webpack.config.js\nconst path = require('path')\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n  mode: 'production',\n}\n\n// src/index.js\nimport { random } from './module'\nconst res = random()\nconsole.log('res: ', res)\n\n// src/module.js\nexport function random() {\n  return Math.random()\n}\nexport function add(a, b) {\n  return a + b\n}\n```\n\n\u6309\u7167\u671f\u671b\u6211\u4eec\u7684\u6253\u5305\u4ea7\u7269\u91cc\u5e94\u8be5\u53ea\u6709 random \u65b9\u6cd5\u7684\u8c03\u7528\uff0c\u8ba9\u6211\u4eec\u770b\u4e0b\u6253\u5305\u7684\u7ed3\u679c\u3002\n\n```ts\n;(() => {\n  'use strict'\n  const o = Math.random()\n  console.log('res: ', o)\n})()\n```\n\n\u8fd9\u4e2a\u7ed3\u679c\u5b8c\u5168\u7b26\u5408\u6211\u4eec\u7684\u671f\u671b\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u7684\u6a21\u5757\u4e2d\u5b58\u5728\u6709\u526f\u4f5c\u7528\u7684\u4ee3\u7801\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\u5462\uff1f\u6211\u4eec\u5728 module.js \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u3002\n\n```ts\n// src/module.js\nexport function random() {\n  return Math.random()\n}\nexport function add(a, b) {\n  return a + b\n}\n// \u6709\u526f\u4f5c\u7528\u7684\u4ee3\u7801\nwindow.test = true\n```\n\n\u6211\u4eec\u518d\u770b\u4e00\u4e0b\u6253\u5305\u540e\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u53d1\u73b0 window.test \u88ab\u6253\u5305\u5230\u4e86\u6700\u540e\u7684\u4ea7\u7269\u4e2d\uff0c\u8fd9\u662f\u5b8c\u5168\u5408\u7406\u7684\uff0c\u56e0\u4e3a\u901a\u8fc7 ESM \u7684\u9759\u6001\u5206\u6790\u662f\u65e0\u6cd5\u5224\u65ad\u4f60\u662f\u5426\u4f7f\u7528\u4e86 test \u8fd9\u4e2a\u53d8\u91cf\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u7a0b\u5e8f\u6700\u7ec8\u7684\u8fd0\u884c\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\uff0cwebpack \u53ea\u80fd\u5c06\u8fd9\u6bb5\u6709\u526f\u4f5c\u7528\u7684\u4ee3\u7801\u6253\u5305\u8fdb\u6700\u7ec8\u7684\u4ea7\u7269\u3002\n\n```ts\n;(() => {\n  'use strict'\n  window.test = !0\n  const o = Math.random()\n  console.log('res: ', o)\n})()\n```\n\n### sideEffects\n\n> \u5982\u679c\u6240\u6709\u4ee3\u7801\u90fd\u4e0d\u5305\u542b\u526f\u4f5c\u7528\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u8be5\u5c5e\u6027\u6807\u8bb0\u4e3a false\uff0c\u6765\u544a\u77e5 webpack \u5b83\u53ef\u4ee5\u5b89\u5168\u5730\u5220\u9664\u672a\u7528\u5230\u7684 export\u3002\n\n\u6309\u7167\u6587\u6863\u4e2d\u7684\u63cf\u8ff0\uff0c\u5982\u679c\u6211\u4eec\u5728 package.json \u4e2d\u6dfb\u52a0 sideEffects \u4e3a false\uff0c\u90a3\u8fd9\u5c31\u4ee3\u8868\u6211\u4eec\u7684\u9879\u76ee\u4e2d\u6240\u6709\u7684\u6a21\u5757\u90fd\u662f\u6ca1\u6709\u526f\u4f5c\u7528\u7684\uff0c\u5728 webpack \u6253\u5305\u7684\u65f6\u5019\u5c31\u4f1a\u5bf9\u5176\u8fdb\u884c\u5220\u9664\uff0c\u90a3\u6211\u4eec\u5728\u539f\u6765\u7684\u793a\u4f8b\u7684\u57fa\u7840\u4e0a\u6dfb\u52a0 sideEffects\uff0c\u770b\u4e00\u4e0b\u6700\u7ec8\u7684\u6253\u5305\u4ea7\u7269\u91cc\u8fd8\u4f1a\u4e0d\u4f1a\u6709 window.test \u8fd9\u6bb5\u6709\u526f\u4f5c\u7528\u7684\u4ee3\u7801\u3002\n\n```ts\n{\n  \"name\": \"webpack-demo\",\n  \"sideEffects\": false,\n}\n```\n\n\u6211\u4eec\u53d1\u73b0\u6700\u7ec8\u7684\u4ea7\u7269\u91cc\u8fd8\u662f\u5b58\u5728 window.test\u3002\n\n```ts\n;(() => {\n  'use strict'\n  window.test = !0\n  const o = Math.random()\n  console.log('res: ', o)\n})()\n```\n\n\u662f\u6587\u6863\u91cc\u8bf4\u9519\u4e86\u5417\uff1f\u5176\u5b9e\u662f\u6211\u4eec\u7406\u89e3\u7684\u6709\u504f\u5dee\uff0csideEffects \u662f\u53ef\u4ee5\u6307\u5b9a\u6211\u4eec\u9879\u76ee\u4e2d\u6240\u6709\u7684\u6a21\u5757\u90fd\u662f\u7eaf\u51c0\u7684\uff0c\u4f46\u662f webpack \u5220\u9664\u6709\u526f\u4f5c\u7528\u6a21\u5757\u7684\u524d\u63d0\u662f\u6211\u4eec\u6ca1\u6709\u4f7f\u7528\u8fd9\u4e2a\u6a21\u5757\u91cc\u7684\u4efb\u4f55\u65b9\u6cd5\u6216\u8005\u53d8\u91cf\u3002\u6211\u4eec\u5728 index.js \u91cc\u4f7f\u7528\u5230\u4e86 module.js \u91cc\u7684 random \u65b9\u6cd5\uff0c\u6240\u4ee5 webpack \u5c31\u4e0d\u80fd\u5220\u9664 module \u8fd9\u4e2a\u6a21\u5757\u91cc\u7684\u526f\u4f5c\u7528\u4ee3\u7801\u3002\n\n\u8ba9\u6211\u4eec\u518d\u6dfb\u52a0\u4e00\u4e2a module2.js\u3002\n\n```ts\n// src/module2.js\nexport const value = 1\n// \u6709\u526f\u4f5c\u7528\nwindow.value = 1\n```\n\n\u7136\u540e\u5728 module.js \u4e2d\u5f15\u5165 value \u5e76\u4e14\u5bfc\u51fa\uff0cindex.js \u4fdd\u6301\u4e0d\u53d8\uff0c\u4ecd\u7136\u53ea\u5f15\u7528 random \u65b9\u6cd5\u3002\n\n```ts\n// src/module.js\nimport { value } from './module2'\n\nexport function random() {\n  return Math.random()\n}\nexport function add(a, b) {\n  return a + b\n}\nexport { value }\nwindow.test = true\n```\n\n\u518d\u8ba9\u6211\u4eec\u770b\u4e0b\u73b0\u5728\u7684\u6253\u5305\u7ed3\u679c\uff0c\u6211\u4eec\u53d1\u73b0\u5728 module2.js \u4e2d\u58f0\u660e\u7684 window.value \u6ca1\u6709\u51fa\u73b0\u5728\u6700\u7ec8\u7684\u6253\u5305\u4ea7\u7269\u91cc\uff0c\u56e0\u4e3a\u81ea\u59cb\u81f3\u7ec8 module2 \u9664\u4e86\u88ab module \u5bfc\u51fa\u4ee5\u5916\uff0c\u6ca1\u6709\u4efb\u4f55\u5730\u65b9\u4f7f\u7528\u5230 module2 \u91cc\u7684\u4efb\u4f55\u53d8\u91cf\u6216\u8005\u65b9\u6cd5\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u901a\u8fc7 sideEffects \u6307\u5b9a\u6240\u6709\u7684\u6a21\u5757\u90fd\u662f\u7eaf\u51c0\u7684\uff0cwebpack \u5c31\u4f1a\u76f4\u63a5\u628a module2 \u6574\u4e2a\u6a21\u5757\u8fc7\u6ee4\u6389\uff0c\u800c\u4e0d\u518d\u53bb\u89e3\u6790\u5185\u90e8\u7684\u4ee3\u7801\u3002\n\n```ts\n;(() => {\n  'use strict'\n  window.test = !0\n  const o = Math.random()\n  console.log('res: ', o)\n})()\n```\n\n\u5982\u679c\u6211\u4eec\u5220\u9664 package.json \u4e2d\u7684 sideEffects\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0 window.value \u51fa\u73b0\u5728\u4e86\u6700\u7ec8\u7684\u4ea7\u7269\u91cc\u3002\n\n```ts\n{\n  \"name\": \"webpack-demo\",\n  // \"sideEffects\": false,\n}\n```\n\n```ts\n;(() => {\n  'use strict'\n  ;(window.value = 1), (window.test = !0)\n  const o = Math.random()\n  console.log('res: ', o)\n})()\n```\n\n\u5230\u8fd9\u91cc\u6211\u4eec\u5e94\u8be5\u53ef\u4ee5\u7406\u89e3 sideEffects \u7684\u4f5c\u7528\u4e86\uff0c\u4ed6\u5e76\u4e0d\u662f\u65e0\u8111\u5e2e webpack \u5220\u9664\u6709\u526f\u4f5c\u7528\u7684\u4ee3\u7801\uff0c\u800c\u662f\u5728\u786e\u5b9a\u4e86\u67d0\u4e2a\u6a21\u5757\u91cc\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\u88ab\u4f7f\u7528\u7684\u65f6\u5c06\u8fd9\u4e2a\u6a21\u5757\u5728\u6253\u5305\u6d41\u7a0b\u4e2d\u8fc7\u6ee4\u6389\uff0c\u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u53d1\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u4ee5\u4e0b\u5f15\u5165\u65b9\u5f0f\u662f\u4e0d\u662f\u4e5f\u6ca1\u4f7f\u7528\u5230 index.css \u91cc\u7684\u4efb\u4f55\u65b9\u6cd5\u6216\u8005\u53d8\u91cf\uff1f\u6ca1\u9519\uff0c\u5982\u679c sideEffects \u6ca1\u6709\u5c06 css \u6392\u9664\u5728\u5916\u7684\u8bdd\uff0c\u5728\u6253\u5305\u7684\u65f6\u5019 index.css \u5c31\u4f1a\u88ab\u8fc7\u6ee4\u6389\uff0c\u4ece\u800c\u5bfc\u81f4\u6837\u5f0f\u4e22\u5931\u3002\n\n```ts\nimport './index.css'\n```\n\n\u4f8b\u5982 swiper6.x \u7ec4\u4ef6\u4e2d\u7684 effect-fade \u7684\u6837\u5f0f\u6587\u4ef6\uff0c\u6211\u4eec\u5c31\u4e0d\u80fd\u76f4\u63a5\u5bf9\u5176\u5f15\u7528\uff0c\u5426\u5219\u5c31\u4f1a\u51fa\u73b0\u6837\u5f0f\u4e22\u5931\u7684\u95ee\u9898\u3002\n\n![webpack_7](/webpack-optimization/webpack_7.jpg)\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u5982\u679c\u6211\u4eec\u5408\u7406\u7684\u4f7f\u7528 sideEffects \u8fd9\u4e2a\u5c5e\u6027\uff0c\u53ef\u4ee5\u4f7f tree-shaking \u7684\u6548\u679c\u66f4\u52a0\u663e\u8457\u3002\n\n## Source Mapping\n\n\u5728\u751f\u4ea7\u73af\u5883\uff0c\u6211\u4eec\u7684\u4ee3\u7801\u5f80\u5f80\u7ecf\u8fc7\u538b\u7f29\u4e11\u5316\u7684\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\u4ee5\u540e\u5df2\u7ecf\u4e0d\u518d\u662f\u4eba\u7c7b\u80fd\u591f\u9605\u8bfb\u7684\u4e86\uff0c\u8fd9\u65f6\u5019\u5982\u679c\u51fa\u73b0\u7ebf\u4e0a\u95ee\u9898\uff0c\u9519\u8bef\u65e5\u5fd7\u540c\u6837\u4e5f\u4f1a\u53d8\u5f97\u4e0d\u53ef\u8bfb\uff0c\u4e3a\u4e86\u89e3\u51b3\u6253\u5305\u540e\u4ee3\u7801\u53ef\u4ee5\u6620\u5c04\u5230\u6e90\u7801\uff0cwebpack \u63d0\u4f9b\u4e86 sourceMap \u7684\u80fd\u529b\u3002\n\n\u6211\u4eec\u5047\u8bbe\u6709\u4ee5\u4e0b\u914d\u7f6e\u548c js \u6587\u4ef6\u3002\n\n```ts\n// webpack.config.js\nconst path = require('path')\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'bundle.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n  mode: 'production',\n  // \u4f7f\u7528\u751f\u4ea7\u73af\u5883\u63a8\u8350\u7684source-map\n  devtool: 'source-map',\n}\n\n// src/index.js\nfunction random() {\n  return Math.random()\n}\nconst res = random()\nres.map((item) => item + 1)\n```\n\n\u6253\u5305\u540e\u6211\u4eec\u53d1\u73b0\u5728\u751f\u6210\u4e86 bundle.js \u4ee5\u5916\u8fd8\u751f\u6210\u4e86\u4e00\u4e2a.map \u6587\u4ef6\uff0c\u8fd9\u4e2a.map \u6587\u4ef6\u5c31\u662f bundle.js \u7684 sourceMap \u6587\u4ef6\u3002\n\n![webpack_8](/webpack-optimization/webpack_8.jpg)\n\n### \u5982\u4f55\u627e\u5230\u5bf9\u5e94\u7684 sourceMap\uff1f\n\n\u5728\u6700\u7ec8\u7684\u4ea7\u7269\u5e95\u90e8\u4f1a\u6709\u4e00\u6bb5\u6ce8\u91ca\u6765\u6307\u5b9a\u5f53\u524d bundle \u5bf9\u5e94\u7684 sourceMap\n\n```ts\nMath.random().map((a) => a + 1)\n//# sourceMappingURL=bundle.js.map\n```\n\n### sourceMap \u5982\u4f55\u6620\u5c04\u6e90\u7801\uff1f\n\n\u8ba9\u6211\u4eec\u770b\u4e00\u4e0b sourceMap \u6587\u4ef6\u7684\u5185\u5bb9\u3002\n\n```ts\n{\n  \"version\": 3,\n  \"file\": \"bundle.js\",\n  \"mappings\": \"AACSA,KAAKC,SAGVC,KAAKC,GAASA,EAAO\",\n  \"sources\": [\n    \"webpack://webpack-demo/./src/index.js\"\n  ],\n  \"sourcesContent\": [\n    \"function random() {\\n  return Math.random();\\n}\\nconst res = random();\\nres.map((item) => item + 1);\\n\"\n  ],\n  \"names\": [\n    \"Math\",\n    \"random\",\n    \"map\",\n    \"item\"\n  ],\n  \"sourceRoot\": \"\"\n}\n\n```\n\n\u5927\u90e8\u5206\u5b57\u6bb5\u7684\u542b\u4e49\u901a\u8fc7\u5185\u5bb9\u5c31\u5f88\u5bb9\u6613\u63a8\u6d4b\uff0c\u552f\u4e00\u6709\u70b9\u7591\u95ee\u7684\u5b57\u6bb5\u5c31\u662f mapping\u3002\u8fd9\u4e2a\u5b57\u6bb5\u7684\u503c\u662f\u901a\u8fc7 Base64 \u7f16\u7801\u5c55\u793a\u7684\uff0c\u4f8b\u5982 mappings \u7684\u7b2c\u4e00\u4e2a\u5143\u7d20 AACSA \u8868\u793a[0,0,1,9,0]\uff0c\u901a\u8fc7[\u8fd9\u91cc](https://www.murzwin.com/base64vlq.html)\u53ef\u4ee5\u770b\u5230\u8f6c\u6362\u540e\u7684\u503c\uff0c\u6bcf\u4e2a\u5b57\u6bcd\u6240\u4ee3\u8868\u7684\u7684\u542b\u4e49\u53ef\u4ee5\u67e5\u770b[\u8fd9\u91cc](https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/view)\uff0c\u7b80\u5355\u7ffb\u8bd1\u4e0b\u53ef\u4ee5\u5f97\u77e5\uff1a\n\n1. \u7b2c\u4e00\u4e2a\u5b57\u6bcd\u8868\u793a\u5728\u751f\u6210\u540e\u7684\u4ee3\u7801\u4e2d\u7684\u5217\u6570\n\n2. \u7b2c\u4e8c\u4e2a\u5b57\u6bcd\u8868\u793a\u5bf9\u5e94\u7684 source \u5217\u8868\u4e0b\u6807\n\n3. \u7b2c\u4e09\u4e2a\u5b57\u6bcd\u8868\u793a\u6e90\u7801\u7684\u884c\u6570\n\n4. \u7b2c\u56db\u4e2a\u5b57\u6bcd\u8868\u793a\u6e90\u7801\u7684\u5217\u6570\n\n5. \u7b2c\u4e94\u4e2a\u5b57\u6bcd\u8868\u793a names \u5217\u8868\u4e2d\u7684\u4e0b\u6807\n\n**\u8fd9\u91cc\u7684\u6bcf\u4e2a\u5b57\u6bcd\u5bf9\u5e94\u7684\u6570\u5b57\u662f\u504f\u79fb\u91cf\uff0c\u5e76\u4e0d\u662f\u5b9e\u9645\u7684\u503c\uff0c\u5e76\u4e14\u5b9e\u9645\u6570\u503c\u8981\u591a 1\u3002\u6211\u4eec\u770b\u4e0b\u793a\u4f8b\uff1a**\n\n1. AACSA \u8868\u793a [0,0,1,9,0]\uff0c\u610f\u601d\u5c31\u662f\uff1anames \u5217\u8868\u91cc\u7684\u7b2c 0 \u4e2a\u5b57\u6bcd Math \u5728\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7684\u7b2c 1 \u5217\uff0c\u5728\u6e90\u7801\u7684\u7b2c 2 \u884c\u7b2c 10 \u5217\n2. KAAKC \u8868\u793a [5,0,0,5,1]\uff0c\u610f\u601d\u5c31\u662f\uff1anames \u5217\u8868\u91cc\u7684\u7b2c 1\uff080 + 1\uff09 \u4e2a\u5b57\u6bcd random \u5728\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7684\u7b2c 6\uff081 + 5\uff09\u5217\uff0c\u5728\u6e90\u7801\u7684\u7b2c 2\uff082 + 0\uff09 \u884c\u7b2c 15\uff0810 + 5\uff09 \u5217\n3. SAGVC \u8868\u793a [9,0,3,-10,1]\uff0c\u610f\u601d\u5c31\u662f\uff1anames \u5217\u8868\u91cc\u7684\u7b2c 2\uff081 + 1\uff09 \u4e2a\u5b57\u6bcd map \u5728\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7684\u7b2c 15\uff086 + 9\uff09\u5217\uff0c\u5728\u6e90\u7801\u7684\u7b2c 5\uff082 + 3\uff09 \u884c\u7b2c 5\uff0815 - 10\uff09 \u5217\n\n\u4f9d\u6b64\u7c7b\u63a8...\n\n\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5c31\u53ef\u4ee5\u5c06\u6253\u5305\u540e\u7684\u4ee3\u7801\u5b9a\u4f4d\u5230\u6e90\u7801\u7684\u76f8\u5e94\u4f4d\u7f6e\uff0c\u4f8b\u5982\u8fd9\u91cc\u7531\u4e8e Math.random \u7684\u8fd4\u56de\u503c\u6ca1\u6709 map \u65b9\u6cd5\u5bfc\u81f4\u62a5\u9519\uff0c\u53ef\u4ee5\u770b\u5230\u9519\u8bef\u5df2\u7ecf\u5b9a\u4f4d\u5230\u4e86 index.js:5:5\u3002\n\n![webpack_9](/webpack-optimization/webpack_9.jpg)\n",pageInfo:{title:"webpack\u4f18\u5316\u6307\u5357",subtitle:"webpack\u4f18\u5316\u6307\u5357"}})}},1011:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/webpack-optimization",function(){return t(5657)}])},3518:function(n){n.exports={imgPreview:"ImgPreview_imgPreview__2OxIp",visible:"ImgPreview_visible__37B3E"}},2472:function(n){n.exports={article:"post_article__2Kkhj",anchor:"post_anchor__3OJU8",translation:"post_translation__2cS_6"}}},function(n){n.O(0,[800,774,888,179],(function(){return e=1011,n(n.s=e);var e}));var e=n.O();_N_E=e}]);