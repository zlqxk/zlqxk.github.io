(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{8420:function(e,n,t){"use strict";t.d(n,{Z:function(){return S}});var r=t(6311),o=t(2472),a=t.n(o),c=t(9980),s=t.n(c),i=t(637),u=new(s())({highlight:function(e,n){var t=u.utils.escapeHtml(e);return n&&i.Z.getLanguage(n)&&(t=i.Z.highlight(n,e,!0).value),'<pre class="hljs"><code>'.concat(t,"</code></pre>")}}),d=u,p=t(2809),l=t(7294),h=t(3518),f=t.n(h),m=t(4184),b=t.n(m),g=t(5893),y=function(e){var n=e.visible,t=e.onClose,r=e.src;return(0,g.jsx)("div",{className:b()(f().imgPreview,(0,p.Z)({},f().visible,n)),onClick:t,children:(0,g.jsx)("img",{src:r})})},x=t(9008),S=(t(7460),function(e){var n=e.content,t=e.pageInfo,o=function(){var e=(0,l.useState)(!1),n=e[0],t=e[1],r=(0,l.useState)(""),o=r[0],a=r[1],c=(0,l.useRef)(null);return(0,l.useEffect)((function(){var e,n,r=null!==(e=null===(n=c.current)||void 0===n?void 0:n.getElementsByTagName("img"))&&void 0!==e?e:[];Array.from(r).forEach((function(e){e.onclick=function(e){e.target instanceof HTMLImageElement&&a(e.target.src),t(!0)}}))}),[]),[c,n,o,t]}(),c=(0,r.Z)(o,4),s=c[0],i=c[1],u=c[2],p=c[3];return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(x.default,{children:[(0,g.jsx)("title",{children:t.title}),(0,g.jsx)("meta",{name:"description",content:t.subtitle})]}),(0,g.jsx)(y,{visible:i,src:u,onClose:function(){return p(!1)}}),(0,g.jsx)("article",{ref:s,className:a().article,dangerouslySetInnerHTML:{__html:d.render(n)}})]})})},7176:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return a}});t(7294);var r=t(8420),o=t(5893),a=function(){return(0,o.jsx)(r.Z,{content:"# Redux \u6e90\u7801\u89e3\u6790\n\n11 \u6708 04, 2021 \u2022 \u2615\ufe0f\u2615\ufe0f\u2615\ufe0f 80 min read\n\n\u672c\u6587\u5c06\u7531\u6d45\u5230\u6df1\u4ecb\u7ecd redux \u53ca\u5176\u8f85\u52a9\u5de5\u5177\u7684\u4f7f\u7528\u53ca\u5176\u539f\u7406\uff0c\u60f3\u5199\u8fd9\u7bc7\u6587\u7ae0\u5f88\u4e45\u4e86\uff0c\u4eca\u5929\u7ec8\u4e8e\u62bd\u51fa\u65f6\u95f4\u6765\u8bb0\u5f55\u4e00\u4e0b\uff0c\u5c0f\u4f19\u4f34\u4eec\u51c6\u5907\u597d\u4e86\u5417\uff0c\u53d1\u8f66\uff01\n\n## 1\u3001redux \u7684\u57fa\u672c\u7684\u4f7f\u7528\n\n\u5148\u7528\u5b98\u7f51\u7684\u4f8b\u5b50\u6765\u4ecb\u7ecd\u4e0b redux \u7684\u6700\u57fa\u672c\u7684\u4f7f\u7528\uff08\u4f7f\u7528\u5728\u539f\u751f js \u4e2d\uff09\n\n> \u6ce8\uff1a \u5728\u9605\u8bfb\u65f6\uff0c\u8bf7\u5148\u6452\u5f03\u4e4b\u524d\u7684\u4f7f\u7528\u4e60\u60ef\uff0c\u4e0d\u8981\u53bb\u601d\u8003 react-redux\uff0cdva\uff0csaga \u7b49\u7528\u6cd5\uff0c\u8fc7\u5ea6\u7ea0\u7ed3\u8f85\u52a9\u5de5\u5177\u7684\u8bed\u6cd5\u53ea\u4f1a\u8ba9\u4f60\u5bf9 redux \u6e90\u7801\u66f4\u52a0\u7ea0\u7ed3\uff0c\u6240\u4ee5\u8bf7\u5148\u629b\u5f03\u4e4b\u524d\u7684\u4f7f\u7528\u8bed\u6cd5\uff0c\u6211\u4eec\u5c31\u4ece\u6700\u539f\u59cb\u7684 redux \u8bed\u6cd5\u5f00\u59cb\u8bb2\u8d77\u3002\u642d\u914d [\u4ee3\u7801](https://github.com/zlqxk/redux-source-code) \u98df\u7528\u66f4\u4f73\n\n```js\n//    ./src/index.jsx\nimport { createStore } from 'redux'\n// \u521b\u5efareducer\nfunction counter(state = 0, action) {\n  switch (action.type) {\n    case 'INCREMENT':\n      return state + 1\n    case 'DECREMENT':\n      return state - 1\n    default:\n      return state\n  }\n}\n// \u4f20\u5165\u521b\u5efa\u7684reducer\u5e76\u521b\u5efastore\nconst store = createStore(counter)\n// \u624b\u52a8\u8ba2\u9605\u66f4\u65b0 (\u5f53dispatch\u65f6\u5c06\u4f1a\u6267\u884c\u56de\u8c03\u51fd\u6570)\nstore.subscribe(() =>\n  // getState() \u7528\u6765\u83b7\u53d6\u6700\u65b0\u7684state\n  console.log(store.getState())\n)\n/**\n * \u6d3e\u53d1action\uff0c\u6bcf\u6b21\u6d3e\u53d1action\u90fd\u4f1a\u5728reducer\u4e2d\u8fdb\u884c\u5339\u914d\uff0c\u7136\u540e\u8fd4\u56de\u5bf9\u5e94\u7684state\n * \u5728\u4e0a\u9762\u6211\u4eec\u5df2\u7ecf\u624b\u52a8\u8ba2\u9605\u4e86\u66f4\u65b0\uff0c\u6240\u4ee5\u6bcf\u6b21\u6d3e\u53d1action\u65f6\uff0c\u90fd\u4f1a\u89e6\u53d1store.subscribe\u56de\u8c03\u51fd\u6570\uff0c\u7136\u540e\u5c06\u6700\u65b0\u7684state\u6253\u5370\u51fa\u6765\n */\nstore.dispatch({ type: 'INCREMENT' })\nstore.dispatch({ type: 'INCREMENT' })\nstore.dispatch({ type: 'INCREMENT' })\n```\n\n\u77ed\u77ed\u51e0\u884c\u4ee3\u7801\u5c31\u53ef\u4ee5\u5b9e\u73b0 redux \u7684\u57fa\u672c\u529f\u80fd\uff0c\u90a3\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u90fd\u7528\u5230\u4e86\u54ea\u51e0\u4e2a api \u5462\uff0c\u6709\u521b\u5efa store \u7684 createStore\uff0c\u548c\u6302\u8f7d\u5728 store \u4e0a\u7684\u8ba2\u9605 subscribe\uff0c\u6d3e\u53d1 action \u7684 dispatch\uff0c\u83b7\u53d6\u6700\u65b0\u72b6\u6001\u7684 getState\uff0c\u90a3\u6211\u4eec\u5c31\u5148\u770b\u4e0b\u8fd9\u51e0\u4e2a\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff08\u53ef\u4ee5\u76f4\u63a5\u5728 node_module \u4e2d\u627e\u5230 redux \u6e90\u7801\u6587\u4ef6\u4e2d\u7684 es \u6587\u4ef6\u5939\u4e0b redux.js \u53bb debugger\uff09\n\n---\n\n\u90a3\u6211\u4eec\u5c31\u5148\u770b\u770b createStore \u5230\u5e95\u6709\u4ec0\u4e48\u7384\u673a\uff0c\u7531\u4e8e createStore \u6e90\u7801\u8f83\u957f\uff0c\u6211\u628a\u4ed6\u62c6\u6210\u51e0\u90e8\u5206\u4e00\u70b9\u4e00\u70b9\u770b\n\n> \u6211\u4eec\u53ef\u4ee5\u770b\u5230 createStore \u63a5\u6536\u4e09\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u4e0a\u9762\u7684\u4f8b\u5b50\u53ea\u4f20\u5165\u4e86\u7b2c\u4e00\u4e2a\u53c2\u6570 reducer\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f preloadedState \u662f\u521d\u59cb\u5316\u72b6\u6001\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f enhancer\uff0c\u8fd9\u4e2a\u7684\u4f5c\u7528\u662f\u7528\u6765\u589e\u5f3a dispatch \u7684\u80fd\u529b\n\n```js\nexport default function createStore(reducer, preloadedState, enhancer) {\n  // \u4e00\u4e9b\u7c7b\u578b\u5224\u65ad\u3002\u3002\u3002\n  if (\n    (typeof preloadedState === 'function' && typeof enhancer === 'function') ||\n    (typeof enhancer === 'function' && typeof arguments[3] === 'function')\n  ) {\n    throw new Error(\n      'It looks like you are passing several store enhancers to ' +\n        'createStore(). This is not supported. Instead, compose them ' +\n        'together to a single function.'\n    )\n  }\n  /**\n   * \u5982\u679c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u5165\u7684\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5e76\u4e14\u6ca1\u6709\u4f20\u5165\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u5219\u628a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8d4b\u503c\u7ed9\u7b2c\u4e09\u4e2a\u53c2\u6570\n   * \u6b63\u662f\u56e0\u4e3a\u8fd9\u6837\u6211\u4eec\u624d\u53ef\u4ee5\u8fd9\u6837\u5199 createStore\uff08reducer, applymiddleware(thunk))\uff0c\u76f4\u63a5\u7701\u7565\n   * \u7b2c\u4e8c\u4e2a\u53c2\u6570preloadedState\n   */\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState\n    preloadedState = undefined\n  }\n  // \u4e00\u4e9b\u7c7b\u578b\u5224\u65ad\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.')\n    }\n    // \u63a5\u53d7\u4e2d\u95f4\u4ef6\u6765\u589e\u5f3adispatch\u7684\u80fd\u529b\uff0c\u5728\u8bb2\u4e2d\u95f4\u4ef6\u7684\u90e8\u5206\u6211\u4eec\u91cd\u70b9\u8bb2\uff0c\u73b0\u5728\u53ef\u4ee5\u5148\u5ffd\u7565\n    return enhancer(createStore)(reducer, preloadedState)\n  }\n  if (typeof reducer !== 'function') {\n    throw new Error('Expected the reducer to be a function.')\n  }\n\n  let currentReducer = reducer // \u4f20\u5165\u7684reducer\n  let currentState = preloadedState // \u4f20\u5165\u7684preloadedState\uff0c\u901a\u5e38\u4e3aundefined\n  let currentListeners = [] // \u521b\u5efa\u4e00\u4e2a\u7528\u6765\u5b58\u653esubscribe\u7684\u6570\u7ec4\uff0c\u56e0\u4e3a\u53ef\u4ee5\u58f0\u660e\u591a\u4e2asubscribe, \u6240\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6570\u7ec4\u6765\u7ef4\u62a4\n  let nextListeners = currentListeners // \u6700\u65b0\u7684\u5b58\u653e\u8ba2\u9605\u7684\u6570\u7ec4\n  let isDispatching = false // \u4e00\u4e2a\u6807\u5fd7\uff0c\u7528\u6765\u5224\u65ad\u662f\u5426\u662f\u6d3e\u53d1\u9636\u6bb5\uff0c\u5728\u540c\u4e00\u65f6\u95f4\u91cc\uff0c\u53ea\u80fd\u89e6\u53d1\u4e00\u6b21action\uff0c\u5982\u679c\u540c\u4e00\u65f6\u95f4\u89e6\u53d1\u4e86\u4e24\u4e2aactoin\uff0c\u90a3\u6570\u636e\u5c31\u4f1a\u7d0a\u4e71\uff0c\u6240\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u9501\u6765\u63a7\u5236\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u89e6\u53d1\u4e00\u6b21action\n  /** \n     * \u7528\u6765\u786e\u4fddnextListeners\u548ccurrentListeners\u4e0d\u662f\u4e00\u4e2a\u5f15\u7528\n     * \u7528\u6765\u4fdd\u8bc1\u5728\u8ba2\u9605\u4e2d\u6dfb\u52a0\u8ba2\u9605\u60c5\u51b5\u65f6\u80fd\u6b63\u5e38\u8fd0\u884c\uff08\u53ef\u4ee5\u81ea\u5df1\u5728redux\u4e2d\u628a\u8fd9\u91cc\u6ce8\u91ca\u6389\uff0c\u7136\u540e\u770b\u4e0b\u6709\u4ec0\u4e48\u53d8\u5316 :)\uff0c\u6240\u4ee5\u901a\u8fc7nextListeners\u548ccurrentListeners\u5171\u540c\u7ef4\u62a4\u8ba2\u9605\u6570\u7ec4\n      store.subscribe(() => {\n        // getState() \u7528\u6765\u83b7\u53d6\u6700\u65b0\u7684state\n        console.log(store.getState())\n        store.subscribe(() => {\n          // getState() \u7528\u6765\u83b7\u53d6\u6700\u65b0\u7684state\n          console.log(store.getState(), '2')\n        });\n      });\n    */\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice()\n    }\n  }\n  /**\n   * getState\u7528\u6765\u8fd4\u56de\u6700\u65b0\u7684\u72b6\u6001\uff0c\u5728\u4e0a\u8ff0\u7684\u4f8b\u5b50\u4e2d\u6211\u4eec\u6b63\u662f\u5728\u8ba2\u9605\u7684\u56de\u8c03\u4e2d\u8c03\u7528\u4e86\u8fd9\u4e2a\u65b9\u6cd5\u6765\u6253\u5370\u6700\u65b0\u7684\u72b6\u6001\n   * console.log(store.getState())\n   * \u90a3\u8fd4\u56de\u7684\u8fd9\u4e2acurrentState\u662f\u4ec0\u4e48\u65f6\u5019\u6539\u53d8\u5462\uff0c\u5728\u540e\u9762\u7684dispatch\u91cc\u6211\u4eec\u4f1a\u8bb2\u5230\n   */\n  function getState() {\n    if (isDispatching) {\n      throw new Error(\n        'You may not call store.getState() while the reducer is executing. ' +\n          'The reducer has already received the state as an argument. ' +\n          'Pass it down from the top reducer instead of reading it from the store.'\n      )\n    }\n    return currentState\n  }\n}\n```\n\n\u7d27\u63a5\u4e0a\u6587\uff0c\u4e0b\u9762\u4ecb\u7ecd createStore \u4e2d\u7684 subscribe \u662f\u600e\u4e48\u5b9e\u73b0\u7684\n\n```js\n// \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2asubscribe\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u4e0a\u9762\u7684\u7684\u4f8b\u5b50\u4f20\u5165\u4e86\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u6765\u6253\u5370\u6700\u65b0\u7684\u72b6\u6001\n// \u518d\u56de\u5fc6\u4e0b\u6211\u4eec\u5f53\u65f6\u600e\u4e48\u4f7f\u7528\u7684\n// store.subscribe(() =>\n//   console.log(store.getState())\n// );\nfunction subscribe(listener) {\n  // \u53ea\u5141\u8bb8\u63a5\u53d7\u51fd\u6570\n  if (typeof listener !== 'function') {\n    throw new Error('Expected the listener to be a function.')\n  }\n  // \u5728reducer\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u80fd\u6267\u884c\u8ba2\u9605\n  if (isDispatching) {\n    throw new Error(\n      'You may not call store.subscribe() while the reducer is executing. ' +\n        'If you would like to be notified after the store has been updated, subscribe from a ' +\n        'component and invoke store.getState() in the callback to access the latest state. ' +\n        'See https://redux.js.org/api-reference/store#subscribelistener for more details.'\n    )\n  }\n  let isSubscribed = true\n\n  // \u7528\u6765\u786e\u4fddnextListeners\u548ccurrentListeners\u4e0d\u662f\u4e00\u4e2a\u5f15\u7528\n  ensureCanMutateNextListeners()\n  /**\n   * \u5c06\u6211\u4eec\u4f20\u5165\u7684\u56de\u8c03\u51fd\u6570push\u5230nextListeners\u8fd9\u4e2a\u6570\u7ec4\u91cc\uff0c\u8fd9\u6837\u540e\u7eed\u6211\u4eecdispatch\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e2a\u6570\u7ec4\u91cc\u904d\u5386\n   * \u627e\u5230\u6211\u4eec\u7684\u56de\u8c03\u51fd\u6570\uff0c\u7136\u540e\u6267\u884c\u5b83\n   */\n  nextListeners.push(listener)\n  // \u8fd4\u56de\u4e00\u4e2a\u7528\u6765\u5378\u8f7d\u8ba2\u9605\u7684\u51fd\u6570\n  // \u8fd9\u6837\u5c31\u53ef\u4ee5\u5378\u8f7d\u8ba2\u9605\n  // store.subscribe(() =>\n  //   console.log(store.getState())\n  // )();\n  return function unsubscribe() {\n    if (!isSubscribed) {\n      return\n    }\n    if (isDispatching) {\n      throw new Error(\n        'You may not unsubscribe from a store listener while the reducer is executing. ' +\n          'See https://redux.js.org/api-reference/store#subscribelistener for more details.'\n      )\n    }\n    isSubscribed = false\n    ensureCanMutateNextListeners()\n    const index = nextListeners.indexOf(listener)\n    nextListeners.splice(index, 1)\n    currentListeners = null\n  }\n}\n```\n\n\u7d27\u63a5\u4e0a\u6587\u6211\u4eec\u4ecb\u7ecd\u4e0b dispatch \u662f\u5982\u4f55\u5b9e\u73b0\u6d3e\u53d1 action \u7684\n\n```js\n/**\n * \u56de\u5fc6\u4e0b\u6211\u4eec\u5f53\u65f6\u662f\u600e\u4e48\u4f7f\u7528\u7684\n * store.dispatch({ type: \"INCREMENT\" })\n * dispatch\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570actino\uff0c\u5176\u4e2d\u89c4\u8303\u7ea6\u5b9a\u662f\u4e00\u4e2a\u5305\u542btype\u7684\u5bf9\u8c61\n */\nfunction dispatch(action) {\n  if (!isPlainObject(action)) {\n    throw new Error('Actions must be plain objects. ' + 'Use custom middleware for async actions.')\n  }\n  /** \n      function isPlainObject(obj) {\n        if (typeof obj !== 'object' || obj === null) return false\n        let proto = obj\n        while (Object.getPrototypeOf(proto) !== null) {\n          proto = Object.getPrototypeOf(proto)\n        }\n        return Object.getPrototypeOf(obj) === proto\n      }\n      * \u8be5\u51fd\u6570\u7684\u4f5c\u7528\u662f\u7528\u6765\u5224\u65ad\u4f20\u5165\u7684acion\u662f\u4e0d\u662f\u4e00\u4e2a\u7b80\u5355\u5bf9\u8c61\n      * \u7b80\u5355\u5bf9\u8c61\uff1anew Object \u6216\u8005 {} \u58f0\u660e\u7684\u5bf9\u8c61\n      * isPlainObject({}) // true\n      * class Per {}\n      * var p = new Per()\n      * isPlainObject(p) // false\n    */\n  // \u5224\u65ad\u662f\u5426\u6709type\u6765\u7ea6\u675f\u6d3e\u53d1\u7684acion\u5fc5\u987b\u5305\u542btype\u5c5e\u6027\n  if (typeof action.type === 'undefined') {\n    throw new Error(\n      'Actions may not have an undefined \"type\" property. ' + 'Have you misspelled a constant?'\n    )\n  }\n  if (isDispatching) {\n    throw new Error('Reducers may not dispatch actions.')\n  }\n  try {\n    isDispatching = true\n    currentState = currentReducer(currentState, action)\n  } finally {\n    isDispatching = false\n  }\n  /** \n     * \u4e0a\u9762\u8fd9\u91cc\u5c31\u662f\u7cbe\u9ad3\u4e86\n     * currentReducer\u5c31\u662f\u6211\u4eec\u521b\u5efastore\u65f6\u4f20\u5165\u7684reducer\n     * @params currentState\u5c31\u662f\u5f53\u524d\u7684\u72b6\u6001\uff0c\u7b2c\u4e00\u6b21\u662f\u6211\u4eec\u7684\u9ed8\u8ba4\u53c2\u6570state = 0\uff0c\u540e\u7eed\u90fd\u662f\u8fd4\u56de\u7684\u6700\u65b0\u7684\u72b6\u6001\n     * @params action = { type: \"INCREMENT\" }\n     * \u7136\u540e\u8fd4\u56de\u65b0\u7684state\u7ed9currentState\n     * \u8fd8\u8bb0\u4e0d\u8bb0\u5f97getState()\u8fd9\u4e2a\u51fd\u6570\uff0cgetState()\u8fd9\u4e2a\u51fd\u6570\u7684\u8fd4\u56de\u503c\u6b63\u662fcurrentState\n     * \u6240\u4ee5\u5b9e\u73b0\u4e86\u6bcf\u6b21\u6d3e\u53d1\u4e00\u4e2aaction\u6539\u53d8\u4e86state\uff0c\u7136\u540e\u901a\u8fc7getState()\u5c31\u80fd\u62ff\u5230\u6700\u65b0\u7684state\n     * \u4f8b\u5b50\u4e2d\u6211\u4eec\u4f20\u5165\u7684reducer:\n      function counter(state = 0, action) {\n        switch (action.type) {\n          case \"INCREMENT\":\n            return state + 1;\n          case \"DECREMENT\":\n            return state - 1;\n          default:\n            return state;\n        }\n      }\n    */\n  const listeners = (currentListeners = nextListeners)\n  for (let i = 0; i < listeners.length; i++) {\n    const listener = listeners[i]\n    listener()\n  }\n  /** \n     * \u4e3a\u4ec0\u4e48\u6bcf\u5f53\u6211\u4eec\u6267\u884cstore.dispatch({ type: \"INCREMENT\" })\uff0csubscribe\u8ba2\u9605\u7684\u56de\u8c03\u51fd\u6570\u90fd\u4f1a\u81ea\u52a8\u6267\u884c\u5462\n     * \u6b63\u662f\u56e0\u4e3a\u5728subscribe\u8fd9\u4e2a\u51fd\u6570\u91cc\u6211\u4eec\u5c06\u8981\u8ba2\u9605\u7684\u56de\u8c03\u51fd\u6570push\u5230\u4e86nextListeners\u8fd9\u4e2a\u6570\u7ec4\u91cc\n     * \u7136\u540e\u5728\u8fd9\u91cc\u6211\u4eec\u5c31\u53ef\u4ee5\u904d\u5386nextListeners\u8fd9\u4e2a\u6570\u7ec4\u6765\u6267\u884c\u6211\u4eec\u8ba2\u9605\u7684\u56de\u8c03\u51fd\u6570\n      store.subscribe(() =>\n        console.log(store.getState())\n      );\n      store.dispatch({ type: \"INCREMENT\" })\n    */\n  return action\n}\n```\n\n---\n\n\u4ee5\u4e0a\u5c31\u662f createStore \u7684\u6838\u5fc3\u90e8\u5206\uff0ccreateStore \u91cc\u6700\u540e\u8fd8\u6709\u4e24\u4e2a\u4e0d\u5e38\u7528\u7684\u51fd\u6570\uff0c\u8fd9\u91cc\u8d34\u51fa\u6765\u5927\u4f53\u89e3\u91ca\u4e0b\n\n```js\n// \u901a\u8fc7\u6761\u4ef6\u5224\u65ad\u4e4b\u540e\uff0c\u4ee5\u8fbe\u5230\u66ff\u6362reducer\u6548\u679c\nfunction replaceReducer(nextReducer) {\n  if (typeof nextReducer !== 'function') {\n    throw new Error('Expected the nextReducer to be a function.')\n  }\n  currentReducer = nextReducer\n  // This action has a similiar effect to ActionTypes.INIT.\n  // Any reducers that existed in both the new and old rootReducer\n  // will receive the previous state. This effectively populates\n  // the new state tree with any relevant data from the old one.\n  dispatch({ type: ActionTypes.REPLACE })\n}\n```\n\n```js\n// \u8fd9\u4e2a\u51fd\u6570\u662f\u7528\u6765\u7ed9\u5f00\u53d1\u8005\u4f7f\u7528\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u4f7f\u7528\u800c\u4e14\u4e0d\u9700\u8981\u638c\u63e1\nfunction observable() {\n  const outerSubscribe = subscribe\n  return {\n    /**\n     * The minimal observable subscription method.\n     * @param {Object} observer Any object that can be used as an observer.\n     * The observer object should have a `next` method.\n     * @returns {subscription} An object with an `unsubscribe` method that can\n     * be used to unsubscribe the observable from the store, and prevent further\n     * emission of values from the observable.\n     */\n    subscribe(observer) {\n      if (typeof observer !== 'object' || observer === null) {\n        throw new TypeError('Expected the observer to be an object.')\n      }\n      function observeState() {\n        if (observer.next) {\n          observer.next(getState())\n        }\n      }\n      observeState()\n      const unsubscribe = outerSubscribe(observeState)\n      return { unsubscribe }\n    },\n    [$$observable]() {\n      return this\n    },\n  }\n}\n```\n\n\u5728 createStore \u7684\u7ed3\u5c3e\u5c06\u8fd9\u4e9b\u65b9\u6cd5\u66b4\u9732\u51fa\u6765\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 store.xxx \u6765\u8c03\u7528\u4e86\n\n```js\n// \u8fd9\u91ccredux\u9ed8\u8ba4\u6d3e\u53d1\u4e86\u4e00\u4e2aaction\u7528\u6765\u521d\u59cb\u5316stateTree\uff0cActionTypes.INIT\u8fd9\u4e2a\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u968f\u673a\u7684\u5b57\u7b26\uff0c\u7528\u6765\u89e6\u53d1reducer\u91cc\u7684switch\u91cc\u7684default\u7684\u56de\u8c03\uff0c\u8fd4\u56de\u521d\u59cb\u5316\u7684\u72b6\u6001\uff0c\u8fd9\u6b21\u7684dispatch\u4e0d\u4f1a\u89e6\u53d1\u8ba2\u9605\uff0c\u56e0\u4e3a\u8ba2\u9605\u5728store\u521b\u5efa\u4e4b\u540e\ndispatch({ type: ActionTypes.INIT })\nreturn {\n  dispatch,\n  subscribe,\n  getState,\n  replaceReducer,\n  [$$observable]: observable,\n}\n```\n\n## 2\u3001combineReducers \u7684\u4f7f\u7528\u53ca\u89e3\u6790\n\n\u4ee5\u4e0a\u5c31\u662f\u6700\u57fa\u7840\u7684 redux \u4f7f\u7528\u53ca\u5176\u6e90\u7801\uff0c\u4f46\u662f\u5728\u6211\u4eec\u7684\u4f7f\u7528\u4e2d\uff0c\u901a\u5e38\u90fd\u662f\u7ef4\u62a4\u4e00\u4e2a\u72b6\u6001\u6811\uff0c\u7136\u540e\u901a\u8fc7\u591a\u4e2a reducer \u6765\u6539\u53d8\u72b6\u6001\u6811\uff0credux \u63d0\u4f9b\u4e86 combineReducers \u8fd9\u4e2a api \u6765\u5e2e\u52a9\u6211\u4eec\u7ef4\u62a4\u591a\u4e2a reducer\uff0c\u5148\u8ba9\u6211\u4eec\u770b\u4e0b\u57fa\u672c\u7684 combineReducers \u7684\u4f7f\u7528\n\n```js\n//   ./src/index2.jsx   \u63d0\u793a\uff1a\u5c06webpack\u5165\u53e3\u6539\u4e3aindex2.jsx\u5373\u53ef\u8fd0\u884c\nimport { createStore, combineReducers } from 'redux'\n// \u521b\u5efa\u591a\u4e2areducer\nfunction counter(state = 0, action) {\n  switch (action.type) {\n    case 'INCREMENT':\n      return state + 1\n    case 'DECREMENT':\n      return state - 1\n    default:\n      return state\n  }\n}\nfunction counter2(state = 0, action) {\n  switch (action.type) {\n    case 'INCREMENT2':\n      return state + 1\n    case 'DECREMENT2':\n      return state - 1\n    default:\n      return state\n  }\n}\n// \u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u770b\u5230combineReducers\u65b9\u6cd5\u63a5\u53d7\u4e00\u4e2a\u5bf9\u8c61\u4e3a\u53c2\u6570\uff0c\u5bf9\u8c61\u7684value\u6b63\u662f\u6bcf\u4e00\u4e2areducer\nconst rootReducer = combineReducers({\n  counter,\n  counter2,\n})\n// \u4f20\u5165\u521b\u5efa\u7684reducer\u5e76\u521b\u5efastore\nconst store = createStore(rootReducer)\n// \u624b\u52a8\u8ba2\u9605\u66f4\u65b0 (\u5f53dispatch action \u5c06\u4f1a\u6267\u884c\u56de\u8c03\u51fd\u6570)\nstore.subscribe(() =>\n  // getState() \u7528\u6765\u83b7\u53d6\u6700\u65b0\u7684state\n  console.log(store.getState())\n)\n/**\n * \u6d3e\u53d1action\uff0c\u6bcf\u6b21\u6d3e\u53d1action\u90fd\u4f1a\u5728reducer\u4e2d\u8fdb\u884c\u5339\u914d\uff0c\u7136\u540e\u8fd4\u56de\u5bf9\u5e94\u7684state\n * \u5728\u4e0a\u9762\u6211\u4eec\u5df2\u7ecf\u624b\u52a8\u8ba2\u9605\u4e86\u66f4\u65b0\uff0c\u6240\u4ee5\u6bcf\u6b21\u6d3e\u53d1action\u65f6\uff0c\u90fd\u4f1a\u89e6\u53d1store.subscribe\u56de\u8c03\u51fd\u6570\uff0c\u7136\u540e\u5c06\u6700\u65b0\u7684state\u6253\u5370\u51fa\u6765\n */\nstore.dispatch({ type: 'INCREMENT' })\nstore.dispatch({ type: 'INCREMENT' })\nstore.dispatch({ type: 'INCREMENT' })\nstore.dispatch({ type: 'INCREMENT2' })\nstore.dispatch({ type: 'INCREMENT2' })\nstore.dispatch({ type: 'INCREMENT2' })\n// \u8f93\u51fa\u7684\u7ed3\u679c\n// {counter: 1, counter2: 0}\n// {counter: 2, counter2: 0}\n// {counter: 3, counter2: 0}\n// {counter: 3, counter2: 1}\n// {counter: 3, counter2: 2}\n// {counter: 3, counter2: 3}\n```\n\n\u4e0a\u8ff0\u7684\u4f8b\u5b50\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0ccreateStore \u8fd9\u4e2a\u65b9\u6cd5\u63a5\u6536\u7684\u662f\u5408\u5e76\u7684 rootReducer \u4e3a\u53c2\u6570\uff0c\u5e76\u4e14 store.getState()\u8fd4\u56de\u7684 state \u53d8\u4e3a\u4e86\u5bf9\u8c61\u7684\u5f62\u5f0f{counter: 1, counter2: 0}\uff0c\u90a3 combineReducers \u7a76\u7adf\u505a\u4e86\u4ec0\u4e48\uff0c\u8ba9\u6211\u4eec\u6765\u4e00\u63a2\u7a76\u7adf\uff01\n\n```js\n// \u53c2\u6570reducers \u4e3a\u6211\u4eec\u4f20\u5165\u7684 {counter: function counter, counter2: function counter2}\nfunction combineReducers(reducers) {\n  // Object.keys\u65b9\u6cd5\u8fd4\u56de\u5bf9\u8c61\u7684\u6240\u6709\u53ef\u679a\u4e3e\u5c5e\u6027\u7684\u6570\u7ec4\n  // reducerKeys = [counter, counter2]\n  const reducerKeys = Object.keys(reducers)\n  const finalReducers = {}\n  for (let i = 0; i < reducerKeys.length; i++) {\n    const key = reducerKeys[i]\n    // \u5982\u679c\u5728\u5f00\u53d1\u73af\u5883\uff0c\u4f1a\u6709\u4e00\u4e2a\u62a5\u9519\u63d0\u793a\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        warning(`No reducer provided for key \"${key}\"`)\n      }\n    }\n\n    /**\n     * \u8fd9\u91cc\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u7b5b\u9009\u7684\u8fc7\u7a0b\uff0c\u5982\u679c\u6211\u4eec\u4f20\u5165\u7684reducers\u53c2\u6570\u662f\u8fd9\u79cd\u683c\u5f0f\n     * {\n     *    counter: function counter\n     *    counter2: function counter2\n     *    counter3: undefined\n     * }\n     * \u90a3\u4e48\u5c06\u4f1a\u628acounter3\u8fc7\u6ee4\u6389\uff0c\u8fd4\u56de\u7684finalReducers\u4e3a\n     *\n     * {\n     *    counter: function counter\n     *    counter2: function counter2\n     * }\n     */\n    if (typeof reducers[key] === 'function') {\n      finalReducers[key] = reducers[key]\n    }\n  }\n\n  const finalReducerKeys = Object.keys(finalReducers)\n  /**\n   *  \u5f97\u5230\u6700\u7ec8\u7684finalReducerKeys\u548cfinalReducers\n   *  finalReducerKeys = ['counter', 'counter2']\n   *  finalReducers = {\n   *    counter: funtion counter,\n   *    counter2: funtion counter2\n   *  }\n   */\n  let unexpectedKeyCache\n  if (process.env.NODE_ENV !== 'production') {\n    unexpectedKeyCache = {}\n  }\n  // \u8fd9\u91cc\u662f\u505a\u4e00\u4e2a\u7c7b\u578b\u5224\u65ad\uff0c\u8fd9\u4e2a\u51fd\u6570\u7684\u89e3\u6790\u5728\u4e0b\u65b9\uff0c\u53ef\u4ee5\u5148\u79fb\u6b65\u4e0b\u65b9assertReducerShape\u7684\u89e3\u6790\n  let shapeAssertionError\n  try {\n    assertReducerShape(finalReducers)\n  } catch (e) {\n    shapeAssertionError = e\n  }\n  /** \n     * \u7cbe\u9ad3\u6765\u4e86\uff0ccombineReducers\u5728\u7ecf\u5386\u4e86\u4e00\u7cfb\u5217\u7684\u5224\u65ad\u540e\uff0c\u6700\u7ec8\u4f1a\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570combination\n      const rootReducer = combineReducers({\n        counter,\n        counter2\n      })\n      const store = createStore(rootReducer);\n     * \u7136\u540e\u6211\u4eec\u518d\u5c06\u8fd9\u4e2a\u51fd\u6570\u4f20\u5165createStore\n     * \u5927\u5bb6\u8fd8\u8bb0\u5f97createStore\u63a5\u53d7\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5417\uff0c\u5728\u6ca1\u6709\u4f7f\u7528combineReducers\u4e4b\u524d\u4f20\u5165\u7684\u662f\u5355\u4e2a\u7684reducer\n     * \u5728\u4f7f\u7528\u4e86\u4e4b\u540e\u4f20\u5165\u7684\u662fcombination\n     * \u518d\u56de\u5fc6\u4e00\u4e0bcreateStore\u4e2d\u7684dispatch\u51fd\u6570\uff0c\u5176\u4e2d\u6700\u4e3b\u8981\u7684\u662f\u4e0b\u9762\u8fd9\u6bb5\n     * try {\n        isDispatching = true\n        currentState = currentReducer(currentState, action)\n      } finally {\n        isDispatching = false\n      }\n     * \u73b0\u5728\u7684currentReducer\u6b63\u662fcombination\n    */\n  return function combination(state = {}, action) {\n    // \u7ed3\u5408\u4e0a\u6587\u7684shapeAssertionError\uff0c \u5982\u679cassertReducerShape\u91cc\u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u90a3\u4e48\u5728\u8fd9\u91cc\u4e5f\u4f1a\u88ab\u963b\u585e\n    if (shapeAssertionError) {\n      throw shapeAssertionError\n    }\n    // \u5982\u679c\u4e0d\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u505a\u4e00\u4e9b\u8b66\u544a\u7ea7\u522b\u7684\u9519\u8bef\n    if (process.env.NODE_ENV !== 'production') {\n      // \u8fd9\u4e2a\u51fd\u6570\u7684\u89e3\u6790\u4e5f\u5728\u4e0b\u65b9\uff0c\u53ef\u4ee5\u5148\u79fb\u6b65\u4e0b\u65b9\u7684getUnexpectedStateShapeWarningMessage\u89e3\u6790\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\n        state, // currentState\n        finalReducers, // \u591a\u4e2areducer\u7ec4\u6210\u7684\u5bf9\u8c61\n        action, // \u4f20\u5165\u7684action\n        unexpectedKeyCache\n      )\n      if (warningMessage) {\n        warning(warningMessage)\n      }\n    }\n\n    // \u7ecf\u8fc7\u4e86\u4e00\u7cfb\u5217\u7684\u5224\u65ad\u4ee5\u540e\uff0c\u7ec8\u4e8e\u6765\u5230\u4e86\u7cbe\u9ad3\u90e8\u5206\n    let hasChanged = false\n    // \u8fd9\u4e2anextState\u5c31\u662f\u6700\u7ec8\u8fd4\u56de\u503c\n    const nextState = {}\n    // finalReducerKeys = ['counter', 'counter2']\n    for (let i = 0; i < finalReducerKeys.length; i++) {\n      // \u4e3a\u4e86\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff0c\u6211\u4eec\u4ee5i=0\u65f6\u523b\u4e3a\u4f8b\uff0c\u770b\u4e00\u4e0b\u6bcf\u4e00\u4e2a\u5b57\u6bb5\u5bf9\u5e94\u7740\u4ec0\u4e48\n      const key = finalReducerKeys[i] // 'counter'\n      const reducer = finalReducers[key] // function counter\n      const previousStateForKey = state[key] // state\u5c31\u662fcurrentState\n      // \u6267\u884cfunction counter\uff0c\u5e76\u4e14\u5c06\u6700\u65b0\u7684state\u8d4b\u503c\u7ed9nextStateForKey\n      const nextStateForKey = reducer(previousStateForKey, action)\n      // \u505a\u4e00\u6b21\u7c7b\u578b\u5224\u65ad\n      if (typeof nextStateForKey === 'undefined') {\n        // getUndefinedStateErrorMessage\u5c31\u662f\u8fd4\u56de\u4e00\u6bb5\u9519\u8bef\u6587\u6848\n        const errorMessage = getUndefinedStateErrorMessage(key, action)\n        throw new Error(errorMessage)\n      }\n      // \u5c06counter\u8fd9\u6b21\u8fd4\u56de\u7684\u6700\u65b0\u7684state\u8d4b\u503c\u5230nextState\u8fd9\u4e2a\u5bf9\u8c61\u91cc\uff0c\u6240\u4ee5\u6211\u4eec\u6700\u540e\u62ff\u5230\u7684\u662f{conuter: 1, counter: 2} \u8fd9\u79cd\u683c\u5f0f\n      nextState[key] = nextStateForKey\n      // hasChanged\u7684\u4f5c\u7528\u662f\u7528\u6765\u5224\u65ad\u6700\u65b0\u7684\u72b6\u6001\u4e0e\u4e0a\u4e00\u6b21\u7684\u72b6\u6001\u6709\u6ca1\u6709\u53d1\u751f\u6539\u53d8\uff0c\u5982\u679c\u53d1\u751f\u6539\u53d8\u5219\u4e3atrue\n      // \u5e76\u4e14\u8fd9\u91cc\u6709\u4e00\u4e2a\u77ed\u8def\u64cd\u4f5c\uff0c\u53ea\u8981\u591a\u4e2areducer\u5176\u4e2d\u6709\u4e00\u4e2a\u72b6\u6001\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u5219hasChanged\u4e3atrue\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\n    }\n    // \u5982\u679c\u6240\u6709\u7684reducer\u90fd\u6ca1\u6709\u6539\u53d8\u72b6\u6001\uff0c\u5219\u8fd4\u56de\u539f\u6765\u7684\u72b6\u6001\uff0c\u5426\u5219\u8fd4\u56de\u6700\u65b0\u7684\u72b6\u6001\n    // \u8fd9\u91cc\u5c31\u6709\u7591\u95ee\u4e86\uff0c\u4e3a\u4ec0\u4e48\u8981\u505a\u8fd9\u4e2a\u5224\u65ad\uff0c\u65e0\u8bba\u6709\u6ca1\u6709\u53d1\u751f\u6539\u53d8\u76f4\u63a5\u8fd4\u56de\u6700\u65b0\u7684\u72b6\u6001\u4e0d\u5c31\u53ef\u4ee5\u4e86\u5417\n    // \u4e2a\u4eba\u7406\u89e3\u8fd9\u91cc\u4e4b\u6240\u4ee5\u8981\u505a\u8fd9\u4e2a\u5224\u65ad\uff0c\u662f\u56e0\u4e3a\u5728\u72b6\u6001\u6ca1\u6709\u6539\u53d8\u7684\u60c5\u51b5\uff0c\u8fd8\u662f\u8fd4\u56de\u4e4b\u524d\u7684\u5f15\u7528\uff0c\u5c31\u4e0d\u5fc5\u518d\u5f00\u8f9f\u65b0\u7684\u5f15\u7528\u6765\u5b58\u50a8\n    // \u65b0\u7684\u72b6\u6001\uff0c\u53ea\u6709\u72b6\u6001\u53d1\u751f\u6539\u53d8\uff0c\u624d\u53bb\u8fd4\u56de\u6700\u65b0\u7684\u5f15\u7528\n    hasChanged = hasChanged || finalReducerKeys.length !== Object.keys(state).length\n    return hasChanged ? nextState : state\n  }\n}\n```\n\nassertReducerShape \u89e3\u6790\uff0c\u4e3b\u8981\u4f5c\u7528\u662f\u4fdd\u8bc1\u4f60\u7684 reducer \u90fd\u662f\u6b63\u5e38\u53ef\u8fd0\u884c\u7684\n\n```js\n// \u5165\u53c2reducers\u4e3a\n// {\n//   counter: funtion counter,\n//   counter2: funtion counter2\n// }\nfunction assertReducerShape(reducers) {\n  Object.keys(reducers).forEach((key) => {\n    const reducer = reducers[key]\n    // \u8fd9\u4e00\u6b65\u76f8\u5f53\u4e8eredux\u624b\u52a8\u6d3e\u53d1\u4e86\u4e00\u6b21action\uff0cActionTypes.INIT\u5728\u4e0a\u6587\u8bb2\u8fc7\uff0c\u5c31\u662f\u662f\u4e00\u4e2a\u968f\u673a\u7684\u5b57\u7b26\u4e32\uff0c\u7528\u6765\u89e6\u53d1reducer\u91ccswitch\u5224\u65ad\u7684defalut\n    // default:\n    //   return state;\n    // \u5982\u679c\u5728reducer\u51fd\u6570\u91cc\u6ca1\u6709\u5199defalut\uff0c\u6216\u8005\u5728default\u91cc\u6ca1\u6709\u8fd4\u56destate\uff0c \u90a3\u4e48\u5c06\u4f1a\u629b\u51fa\u4e0b\u9762\u7684\u5f02\u5e38\n    const initialState = reducer(undefined, { type: ActionTypes.INIT })\n    if (typeof initialState === 'undefined') {\n      throw new Error(\n        `Reducer \"${key}\" returned undefined during initialization. ` +\n          `If the state passed to the reducer is undefined, you must ` +\n          `explicitly return the initial state. The initial state may ` +\n          `not be undefined. If you don't want to set a value for this reducer, ` +\n          `you can use null instead of undefined.`\n      )\n    }\n    // \u8fd9\u91cc\u662f\u786e\u4fdd\u4e0d\u80fd\u5360\u7528redux\u5185\u90e8\u7279\u6709\u7684\u547d\u540d\u7a7a\u95f4 redux/*\n    if (\n      typeof reducer(undefined, {\n        type: ActionTypes.PROBE_UNKNOWN_ACTION(),\n      }) === 'undefined'\n    ) {\n      throw new Error(\n        `Reducer \"${key}\" returned undefined when probed with a random type. ` +\n          `Don't try to handle ${ActionTypes.INIT} or other actions in \"redux/*\" ` +\n          `namespace. They are considered private. Instead, you must return the ` +\n          `current state for any unknown actions, unless it is undefined, ` +\n          `in which case you must return the initial state, regardless of the ` +\n          `action type. The initial state may not be undefined, but can be null.`\n      )\n    }\n  })\n}\n```\n\ngetUnexpectedStateShapeWarningMessage \u89e3\u6790\uff0c\u4e3b\u8981\u662f\u4e00\u4e9b\u8b66\u544a\u9519\u8bef\uff0c\u5224\u65ad reducers \u662f\u5426\u4e3a\u7a7a\uff0cinputState \u662f\u5426\u662f\u7b80\u5355\u5bf9\u8c61\u7b49\n\n```js\n/**\n * @params inputState \u4e5f\u5c31\u662fcurrentState\n * @params reducers \u4e5f\u5c31\u662ffinalReducers\n * @params action\n */\nfunction getUnexpectedStateShapeWarningMessage(inputState, reducers, action, unexpectedKeyCache) {\n  // \u56fd\u9645\u60ef\u4f8b\uff0c\u8fd8\u662f\u5148\u53d6\u51fa\u591a\u4e2areducers\u5c5e\u6027\u7ec4\u6210\u7684\u6570\u7ec4 reducerKeys = ['counter', 'counter2']\n  const reducerKeys = Object.keys(reducers)\n  const argumentName =\n    // \u8fd9\u5757\u5176\u5b9e\u5c31\u662f\u6839\u636eaction.type\u6765\u786e\u5b9a\u62a5\u9519\u65f6\u5019\u7684\u6587\u6848\n    action && action.type === ActionTypes.INIT\n      ? 'preloadedState argument passed to createStore'\n      : 'previous state received by the reducer'\n  // \u81f3\u5c11\u8981\u6709\u4e00\u4e2areducer\n  if (reducerKeys.length === 0) {\n    return (\n      'Store does not have a valid reducer. Make sure the argument passed ' +\n      'to combineReducers is an object whose values are reducers.'\n    )\n  }\n  // \u8fd9\u4e2a\u5730\u65b9\u5224\u65ad\u7b2c\u4e00\u4e2a\u53c2\u6570inputState\u662f\u4e0d\u662f\u4e00\u4e2a\u7b80\u5355\u5bf9\u8c61\n  // \u8fd9\u4e2a\u65f6\u5019\u673a\u667a\u7684\u5c0f\u4f19\u4f34\u5c31\u5df2\u7ecf\u53d1\u73b0\uff0c\u6211\u4eec\u5bf9currentState\u7684\u5224\u65ad\u5df2\u7ecf\u53d8\u6210\u4e86\u4e00\u4e2a\u7b80\u5355\u5bf9\u8c61\n  // \u56de\u5fc6\u4e00\u4e0b\uff0cstore.getState()\u8fd4\u56de\u7684\u6570\u636e\u683c\u5f0f {counter: 3, counter2: 3}\n  if (!isPlainObject(inputState)) {\n    return (\n      `The ${argumentName} has unexpected type of \"` +\n      {}.toString.call(inputState).match(/\\s([a-z|A-Z]+)/)[1] +\n      `\". Expected argument to be an object with the following ` +\n      `keys: \"${reducerKeys.join('\", \"')}\"`\n    )\n  }\n  // \u4ee5\u4e0b\u64cd\u4f5c\u4e3b\u8981\u662f\u7528\u6765\u786e\u4fdd\u6709\u6ca1\u6709\u4e0d\u5408\u7406\u7684key\n  const unexpectedKeys = Object.keys(inputState).filter(\n    // reducers.hasOwnProperty(key)\u7528\u6765\u5224\u65ad\u5bf9\u8c61reducers\u91cc\u6709\u6ca1\u6709\u5c5e\u6027key\n    (key) => !reducers.hasOwnProperty(key) && !unexpectedKeyCache[key]\n  )\n  unexpectedKeys.forEach((key) => {\n    unexpectedKeyCache[key] = true\n  })\n  if (action && action.type === ActionTypes.REPLACE) return\n  if (unexpectedKeys.length > 0) {\n    return (\n      `Unexpected ${unexpectedKeys.length > 1 ? 'keys' : 'key'} ` +\n      `\"${unexpectedKeys.join('\", \"')}\" found in ${argumentName}. ` +\n      `Expected to find one of the known reducer keys instead: ` +\n      `\"${reducerKeys.join('\", \"')}\". Unexpected keys will be ignored.`\n    )\n  }\n}\n```\n\n## 3\u3001combineReducers \u8fdb\u9636\u7528\u6cd5\u53ca\u5176\u89e3\u6790\n\n\u5728\u4f7f\u7528\u4e2d\u6211\u4eec\u901a\u5e38\u4f1a\u58f0\u660e\u4e00\u4e2a\u521d\u59cb\u5316\u5bf9\u8c61\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u5bf9\u8c61\u4f20\u7ed9\u4e0d\u540c\u7684 reducer\uff0c\u7531\u4e8e\u58f0\u660e\u7684\u521d\u59cb\u5316\u5bf9\u8c61\u662f\u4e00\u4e2a\u5f15\u7528\u6570\u636e\u7c7b\u578b\uff0c\u5728\u4f7f\u7528\u8fd9\u6211\u4eec\u5c31\u4f1a\u53d1\u73b0\u4e00\u4e9b\u95ee\u9898\uff0c\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\n\n```js\n//  ./src/index3.jsx\nimport { createStore, combineReducers } from 'redux'\nconst count = {\n  num: 0,\n}\nconst count2 = {\n  num2: 0,\n}\n// \u9519\u8bef\u7528\u6cd5\nconst handleData = (state, type) => {\n  state[type] += 1\n  return state\n}\nfunction counter(state = count, action) {\n  switch (action.type) {\n    case 'INCREMENT':\n      return handleData(state, 'num')\n    default:\n      return state\n  }\n}\nfunction counter2(state = count2, action) {\n  switch (action.type) {\n    case 'INCREMENT2':\n      return handleData(state, 'num2')\n    default:\n      return state\n  }\n}\nconst rootReducer = combineReducers({\n  counter,\n  counter2,\n})\nconst store = createStore(rootReducer)\nstore.dispatch({ type: 'INCREMENT' })\nconst a = store.getState()\nstore.dispatch({ type: 'INCREMENT' })\nconst b = store.getState()\nstore.dispatch({ type: 'INCREMENT2' })\nconst c = store.getState()\nstore.dispatch({ type: 'INCREMENT2' })\nconst d = store.getState()\nconsole.log(a, 'a')\nconsole.log(b, 'b')\nconsole.log(c, 'b')\nconsole.log(d, 'd')\n```\n\n\u601d\u8003\u4e00\u4e0b\uff0c\u6700\u540e\u7684\u56db\u4e2a console \u6253\u5370\u7ed3\u679c\u662f\u4ec0\u4e48\u5462\uff0c\u6211\u4eec\u671f\u671b\u7684\u662f\u4f9d\u6b21\u6253\u5370\u51fa\u6bcf\u6b21\u7684 dispatch \u4fee\u6539\u540e\u7684 state\uff0c\u7ed3\u679c\u56db\u6b21\u6253\u5370\u7684\u90fd\u662f{counter: {num: 2}, counter2: {num2: 2}}\uff0c\u90a3\u600e\u6837\u53bb\u5b9e\u73b0\u671f\u671b\u7684\u6548\u679c\u5462\uff0c\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff0c\u5bf9 state \u505a\u4e00\u5c42\u6df1\u62f7\u8d1d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6539\u5199\u4e00\u4e0b handleData \u5373\u53ef\n\n```js\nconst handleData = (state, type) => {\n  state = Object.assign({}, state, {\n    [type]: state[type] + 1,\n  })\n  return state\n}\n// \u6216\u8005\u4f7f\u7528\u5c55\u5f00\u8fd0\u7b97\u7b26\nconst handleData = (state, type) => {\n  return { ...state, [type]: state[type] + 1 }\n}\n```\n\n3.1\u3001\u4f7f\u7528 immutable \u5bf9\u8c61\n\n\u4f46\u662f\u8fd9\u6837\u8fd8\u662f\u4e0d\u591f\u4f18\u96c5\uff0c\u5982\u679c\u521d\u59cb\u5316\u7684 state \u662f\u591a\u5c42\u7684\u5bf9\u8c61\uff0c\u53ea\u662f\u4e00\u5c42\u7684\u6df1\u62f7\u8d1d\u7684 Object.assign \u548c\u5c55\u5f00\u8fd0\u7b97\u7b26\u5c31\u5931\u6548\u4e86\uff0c\u5982\u679c\u76f4\u63a5\u4f7f\u7528\u6df1\u5c42\u6b21\u7684 deepClone\uff0c\u5728\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\u53c8\u4f1a\u6709\u6027\u80fd\u95ee\u9898\uff0c\u8fd9\u65f6\u5019 immutable \u5bf9\u8c61\u5c31\u6392\u4e0a\u7528\u573a\u4e86\uff0cimmutable \u58f0\u660e\u7684\u6570\u636e\u88ab\u89c6\u4e3a\u4e0d\u53ef\u53d8\u7684\uff0c\u4efb\u4f55\u6dfb\u52a0\u3001\u5220\u9664\u3001\u4fee\u6539\u64cd\u4f5c\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u8fd9\u65f6\u5019\u5c0f\u4f19\u4f34\u53c8\u6709\u7591\u95ee\u4e86\uff0c\u90a3\u8fd9\u548c\u6df1\u62f7\u8d1d\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff0cimmutable \u5b9e\u73b0\u7684\u539f\u7406\u662f\u6301\u4e45\u5316\u6570\u636e\u7ed3\u6784\u5171\u4eab\uff0c\u5373\u5982\u679c\u5bf9\u8c61\u6811\u4e2d\u4e00\u4e2a\u8282\u70b9\u53d1\u751f\u53d8\u5316\uff0c\u53ea\u4fee\u6539\u8fd9\u4e2a\u8282\u70b9\u548c\u53d7\u5b83\u5f71\u54cd\u7684\u7236\u8282\u70b9\uff0c\u5176\u5b83\u8282\u70b9\u5219\u8fdb\u884c\u5171\u4eab\uff0c\u770b\u4e0b\u9762\u7684\u52a8\u56fe\u5c31\u65b9\u4fbf\u7406\u89e3 immutable \u5bf9\u8c61\u4e86\n\n![\u6301\u4e45\u5316\u6570\u636e\u7ed3\u6784\u5171\u4eab](/redux-source-code/immutable.gif)\n\nimmutable \u901a\u8fc7 set \u548c get \u6765\u8fdb\u884c\u8d4b\u503c\u548c\u53d6\u503c\u64cd\u4f5c\uff0cimmutable \u7684\u5177\u4f53\u8bed\u6cd5\u5c0f\u4f19\u4f34\u8bf7\u81ea\u884c\u67e5\u9605[\u8d44\u6599]\u54e6(https://www.npmjs.com/package/immutable), \u90a3\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5728 redux \u4e2d\u4f7f\u7528\u4e0d\u53ef\u53d8\u5bf9\u8c61\u5427\uff0c\u5148\u6765\u770b\u4e00\u4e0b\u4e0d\u4f7f\u7528 combineReducer \u7684\u60c5\u51b5\u3002\n\n```js\n// ./src/index4.jsx\nimport { createStore } from 'redux'\nimport { fromJS } from 'immutable'\nconst initState = {\n  num: 0,\n}\n// \u4f7f\u7528formJS\u6765\u5c06js\u5bf9\u8c61\u8f6c\u6362\u4e3aimmutable\u5bf9\u8c61\nfunction counter(state = fromJS(initState), action) {\n  switch (action.type) {\n    case 'INCREMENT':\n      return state.set('num', state.get('num') + 1)\n    default:\n      return state\n  }\n}\nconst store = createStore(counter)\nstore.dispatch({ type: 'INCREMENT' })\nconst a = store.getState().get('num')\nstore.dispatch({ type: 'INCREMENT' })\nconst b = store.getState().get('num')\nconsole.log(a, 'a') // 1\nconsole.log(b, 'b') // 2\n```\n\n### 3.2\u3001redux-immutable \u7684\u4f7f\u7528\u548c\u89e3\u6790\n\n\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5b9e\u73b0\u4e86\u9884\u671f\u7684\u6548\u679c\uff0c\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u8981\u4f7f\u7528 combineReducer \u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\uff0credux \u63d0\u4f9b\u7684 combineReducer \u65b9\u6cd5\u6211\u4eec\u4e0a\u9762\u4e5f\u9605\u8bfb\u8fc7\u4e86\uff0c\u53ea\u80fd\u5904\u7406 js \u5bf9\u8c61\uff0c\u5982\u679c\u628a immutable \u5bf9\u8c61\u4e0e redux \u63d0\u4f9b\u7684 combineReducer \u4e00\u8d77\u4f7f\u7528\uff0c\u5c31\u4f1a\u51fa\u73b0\u5916\u5c42\u662f js \u5bf9\u8c61\uff0c\u5185\u5c42\u662f immutable \u5bf9\u8c61\u7684\u60c5\u51b5\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\uff0c\u7531\u4e8e\u5f88\u591a\u5f00\u53d1\u8005\u91c7\u7528\u4e86 Immutable.js\uff0c\u6240\u4ee5\u4e5f\u6709\u5f88\u591a\u7c7b\u4f3c\u7684\u8f85\u52a9\u5de5\u5177\uff0c\u4f8b\u5982 redux-immutable\u3002\u8fd9\u4e2a\u7b2c\u4e09\u65b9\u5305\u5b9e\u73b0\u4e86\u4e00\u4e2a\u80fd\u591f\u5904\u7406 Immutable Map \u6570\u636e\u800c\u975e\u666e\u901a\u7684 JavaScript \u5bf9\u8c61\u7684 combineReducers\n\n```js\n// ./src/index5.jsx\nimport { createStore } from 'redux'\nimport { fromJS } from 'immutable'\nimport { combineReducers } from 'redux-immutable'\nconst count = {\n  num: 0,\n}\nconst count2 = {\n  num2: 0,\n}\n// \u4f7f\u7528formJS\u6765\u5c06js\u5bf9\u8c61\u8f6c\u6362\u4e3aimmutable\u5bf9\u8c61\nfunction counter(state = fromJS(count), action) {\n  switch (action.type) {\n    case 'INCREMENT':\n      return state.set('num', state.get('num') + 1)\n    default:\n      return state\n  }\n}\nfunction counter2(state = fromJS(count2), action) {\n  switch (action.type) {\n    case 'INCREMENT2':\n      return state.set('num2', state.get('num2') + 1)\n    default:\n      return state\n  }\n}\nconst rootReducer = combineReducers({\n  counter,\n  counter2,\n})\nconst store = createStore(rootReducer)\nstore.dispatch({ type: 'INCREMENT' })\nconst a = store.getState().getIn(['counter', 'num'])\nstore.dispatch({ type: 'INCREMENT' })\nconst b = store.getState().getIn(['counter', 'num'])\nstore.dispatch({ type: 'INCREMENT2' })\nconst c = store.getState().getIn(['counter2', 'num2'])\nstore.dispatch({ type: 'INCREMENT2' })\nconst d = store.getState().getIn(['counter2', 'num2'])\nconsole.log(a, 'a') // 1\nconsole.log(b, 'b') // 2\nconsole.log(c, 'c') // 1\nconsole.log(d, 'd') // 2\n```\n\n\u901a\u8fc7 redux-immutable \u6211\u4eec\u53c8\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5b8c\u6574\u7684 immutable \u5bf9\u8c61\u4e86\uff0c\u90a3 redux-immutable \u548c redux \u63d0\u4f9b\u7684 combineReducer \u6709\u4ec0\u4e48\u533a\u522b\u5462\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e0b redux-immutable \u7684 combineReducer[\u6e90\u7801](https://github.com/gajus/redux-immutable/blob/master/src/combineReducers.js)\n\n```js\nimport Immutable from 'immutable'\nimport { getUnexpectedInvocationParameterMessage, validateNextState } from './utilities'\n/**\n * @params reducers \u6211\u4eec\u4f20\u5165\u7684reducer\n * @params getDefaultState \u6bd4redux combineReducer\u591a\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u72b6\u6001\u7684\u53c2\u6570\uff0c\u4f46\u662f\u901a\u5e38\u6211\u4eec\u4e5f\u4e0d\u4f7f\u7528\u4ed6\n */\nexport default (reducers: Object, getDefaultState: ?Function = Immutable.Map): Function => {\n  const reducerKeys = Object.keys(reducers)\n  return (inputState: ?Function = getDefaultState(), action: Object): Immutable.Map => {\n    // \u4e0e\u4e4b\u524d\u7684\u4e00\u6837\uff0c\u5728\u5f00\u53d1\u73af\u5883\u4e0b\u4f1a\u505a\u4e00\u4e9b\u7c7b\u578b\u6821\u9a8c\n    if (process.env.NODE_ENV !== 'production') {\n      const warningMessage = getUnexpectedInvocationParameterMessage(inputState, reducers, action)\n      if (warningMessage) {\n        // eslint-disable-next-line no-console\n        console.error(warningMessage)\n      }\n    }\n    //withMutations \u4e3b\u8981\u7528\u6765\u63d0\u5347\u6027\u80fd\uff0c\u5c06\u9700\u8981\u591a\u6b21\u521b\u5efa\u7684Imutable\u5408\u5e76\u6210\u4e00\u6b21\u3002\u4e3b\u8981\u4f7f\u7528\u5728\u9700\u8981\u5bf9imutable \u9700\u8981\u8fdb\u884c\u591a\u6b21\u4e2d\u95f4\u64cd\u4f5c\uff0c\u6700\u7ec8\u8fd4\u56de\u4e00\u4e2aImutable\u7684\u60c5\u51b5\u4e0b\n    return inputState.withMutations((temporaryState) => {\n      // \u8fd9\u5757\u5c31\u548credux combineReducer\u57fa\u672c\u4e00\u6837\u4e86\uff0c\u53ea\u4e0d\u8fc7\u628a\u5bf9js\u5bf9\u8c61\u7684\u64cd\u4f5c\u65b9\u6cd5\u8f6c\u6362\u4e3a\u4e86immutable\u7684api\n      reducerKeys.forEach((reducerName) => {\n        const reducer = reducers[reducerName]\n        const currentDomainState = temporaryState.get(reducerName)\n        const nextDomainState = reducer(currentDomainState, action)\n        validateNextState(nextDomainState, reducerName, action)\n        /** \n             * validateNextState\u8fd9\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u4e5f\u5c31\u662f\u4e00\u4e2a\u7c7b\u578b\u6821\u9a8c\n              export default (nextState, reducerName: string, action: Object): void => {\n                if (nextState === undefined) {\n                  throw new Error('Reducer \"' + reducerName + '\" returned undefined when handling \"' + action.type + '\" action. To ignore an action, you must explicitly return the previous state.');\n                }\n              };\n            */\n        temporaryState.set(reducerName, nextDomainState)\n      })\n    })\n  }\n}\n```\n\n\u5728\u7406\u89e3\u4e86 redux combineReducer \u7684\u6e90\u7801\u4ee5\u540e\u518d\u6765\u770b redux-immutable \u5176\u5b9e\u5f88\u597d\u7406\u89e3\u4e86\uff0c\u4e3b\u6d41\u7a0b\u4e0e redux combineReducer \u4e00\u81f4\uff0c\u53ea\u4e0d\u8fc7\u662f\u628a\u5bf9 js \u5bf9\u8c61\u7684\u64cd\u4f5c\u65b9\u6cd5\u8f6c\u6362\u4e3a\u4e86 immutable \u7684 api\u3002\n\n## 4\u3001bindActionCreators \u7528\u6cd5\u53ca\u5176\u89e3\u6790\n\n\u770b\u5230\u8fd9\u91cc\u6709\u7684\u5c0f\u4f19\u4f34\u4f1a\u95ee\uff0c\u4e3a\u4ec0\u4e48\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\u6d3e\u53d1 action \u90fd\u662f\u7528\u7684 store.dispatch\uff0c\u800c\u5728\u5b9e\u9645\u5e94\u7528\u7684\u65f6\u5019\u597d\u50cf\u5f88\u5c11\u8fd9\u6837\u5199\uff0c\u901a\u5e38\u90fd\u662f\u4ee5\u51fd\u6570\u7684\u5f62\u5f0f\u6765\u6d3e\u53d1 action \u5462\uff1f\u8fd9\u5c31\u662f bindActionCreators \u7684\u529f\u52b3\u4e86\uff0cbindActionCreators \u4f1a\u5bf9\u6bcf\u4e2a action creator \u8fdb\u884c\u5305\u88c5\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u5b83\u4eec\uff0c\u90a3\u6211\u4eec\u901a\u8fc7\u4f8b\u5b50 \ud83c\udf30 \u6765\u770b\u4e00\u4e0b bindActionCreators \u5982\u4f55\u4f7f\u7528\n\n```js\n//   ./src/index6.jsx\nimport { createStore, bindActionCreators } from 'redux'\nconst initState = {\n  num1: 0,\n  num2: 0,\n  num3: 0,\n  num4: 0,\n}\nfunction counter(state = initState, action) {\n  switch (action.type) {\n    case 'ADD_NUM1':\n      return { ...state, num1: state.num1 + 1 }\n    case 'ADD_NUM2':\n      return { ...state, num2: state.num2 + 1 }\n    case 'ADD_NUM3':\n      return { ...state, num3: state.num3 + 1 }\n    case 'ADD_NUM4':\n      return { ...state, num4: state.num4 + 1 }\n    default:\n      return state\n  }\n}\nconst store = createStore(counter)\n// \u58f0\u660e\u4e86\u56db\u4e2a\u7684action creator\uff0c\u8fd4\u56de\u503c\u5c31\u662f\u8981\u6d3e\u53d1\u7684action\nconst ADD_NUM1 = () => {\n  return {\n    type: 'ADD_NUM1',\n  }\n}\nconst ADD_NUM2 = () => {\n  return {\n    type: 'ADD_NUM2',\n  }\n}\nconst ADD_NUM3 = () => {\n  return {\n    type: 'ADD_NUM3',\n  }\n}\nconst ADD_NUM4 = () => {\n  return {\n    type: 'ADD_NUM4',\n  }\n}\n/**\n * bindActionCreators(actionCreators, dispatch)\n * \u8fd9\u4e2a\u65b9\u6cd5\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\n * actionCreators\uff1a \u4e00\u4e2a action creator\uff0c\u6216\u8005\u4e00\u4e2a value \u662f action creator \u7684\u5bf9\u8c61\u3002\n * dispatch\uff1a \u4e00\u4e2a\u7531 Store \u5b9e\u4f8b\u63d0\u4f9b\u7684 dispatch \u51fd\u6570\u3002\n */\nconst boundActionCreators = bindActionCreators(\n  {\n    ADD_NUM1,\n    ADD_NUM2,\n    ADD_NUM3,\n    ADD_NUM4,\n  },\n  store.dispatch\n)\nconsole.log(boundActionCreators)\n// \u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u5f0f\u8c03\u7528\u4e86\nboundActionCreators.ADD_NUM1()\nboundActionCreators.ADD_NUM2()\nboundActionCreators.ADD_NUM3()\nboundActionCreators.ADD_NUM4()\nconsole.log(store.getState())\n```\n\n\u6ce8\uff1a\u552f\u4e00\u4f1a\u4f7f\u7528\u5230 bindActionCreators \u7684\u573a\u666f\u662f\u5f53\u4f60\u9700\u8981\u628a action creator \u5f80\u4e0b\u4f20\u5230\u4e00\u4e2a\u7ec4\u4ef6\u4e0a\uff0c\u5374\u4e0d\u60f3\u8ba9\u8fd9\u4e2a\u7ec4\u4ef6\u89c9\u5bdf\u5230 Redux \u7684\u5b58\u5728\uff0c\u800c\u4e14\u4e0d\u5e0c\u671b\u628a dispatch \u6216 Redux store \u4f20\u7ed9\u5b83\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u5728\u4efb\u4f55\u573a\u666f\u4e0b\u4f7f\u7528\u3002:) \uff0c\u90a3\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u770b\u4e00\u4e0b bindActionCreators \u662f\u600e\u6837\u5e2e\u6211\u4eec\u505a\u5230\u6d3e\u53d1 action \u7684.\n\n```js\n/**\n * actionCreators\uff1a \u4e00\u4e2a action creator\uff0c\u6216\u8005\u4e00\u4e2a value \u662f action creator \u7684\u5bf9\u8c61\u3002\n * dispatch\uff1a \u4e00\u4e2a\u7531 Store \u5b9e\u4f8b\u63d0\u4f9b\u7684 dispatch \u51fd\u6570\u3002\n */\nexport default function bindActionCreators(actionCreators, dispatch) {\n  // \u5982\u679c\u6211\u4eec\u53ea\u4f20\u5165\u4e86\u4e00\u4e2aaction creator\uff0c\u8fd4\u56debindActionCreator\u8fd9\u4e2a\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff08\u8fd9\u4e2a\u51fd\u6570\u6211\u628a\u4ed6\u653e\u5728\u4e86\u4e0b\u9762\uff09\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch)\n  }\n  // \u56fd\u9645\u60ef\u4f8b\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error(\n      `bindActionCreators expected an object or a function, instead received ${\n        actionCreators === null ? 'null' : typeof actionCreators\n      }. ` +\n        `Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?`\n    )\n  }\n  // \u5982\u679c\u6211\u4eec\u4f20\u5165actionCreators\u7684\u662f\u4e00\u4e2aaction creator \u7684\u5bf9\u8c61\uff0c\u90a3\u4e48\u5c31\u5faa\u73af\u904d\u5386\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u7136\u540e\u628a\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u8f6c\u6362\u6210bindActionCreator\n  const boundActionCreators = {}\n  for (const key in actionCreators) {\n    const actionCreator = actionCreators[key]\n    if (typeof actionCreator === 'function') {\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)\n    }\n  }\n  return boundActionCreators\n}\n/**\n * \u5982\u679cbindActionCreators\u7b2c\u4e00\u4e2a\u53c2\u6570\u53ea\u4f20\u5165\u4e86\u4e00\u4e2a action creator\uff0c\u5c06\u4f1a\u8fd4\u56de\u4e0b\u9762\u8fd9\u4e2a\u51fd\u6570\n * actionCreator\uff1a \u4f20\u5165\u7684 action creator\n * dispatch\uff1a store.dispatch\n */\nfunction bindActionCreator(actionCreator, dispatch) {\n  // \u8fd9\u4e2a\u5176\u5b9e\u5f88\u597d\u7406\u89e3\uff0cdispatch\u5c31\u662fstore.dispatch\n  // actionCreator.apply(this, arguments)\u8fd9\u4e2a\u5176\u5b9e\u5c31\u662f\u8c03\u7528\u4e86\u6211\u4eec\u58f0\u660e\u7684action creator\uff0c\u8fd4\u56de\u503c\u4e5f\u5c31\u662f {type: xxxxx}\n  // \u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u53ea\u8981\u6211\u4eec\u8c03\u7528ADD_NUM\u5c31\u76f8\u5f53\u4e8e\u6267\u884c\u4e86store.dispatch({type:xxxxx})\n  return function () {\n    return dispatch(actionCreator.apply(this, arguments))\n  }\n}\n```\n\nbindActionCreators \u5f88\u5de7\u5999\u7684\u5c06 dispatch({type:xxx})\u7684\u683c\u5f0f\u8f6c\u6362\u6210\u4e86\u6211\u4eec\u719f\u6089\u7684\u51fd\u6570\u7684\u5f62\u5f0f\uff0c\u5e76\u4e14\u5982\u679c\u5e94\u7528\u5728 react \u4e2d\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u8fd9\u4e2a\u51fd\u6570\u4f20\u5230\u5b50\u7ec4\u4ef6\uff0c\u8fd9\u6837\u5b50\u7ec4\u4ef6\u5e76\u4e0d\u4f1a\u611f\u77e5\u5230 redux\n\n## 5\u3001applyMiddleware \u7684\u4f7f\u7528\u548c\u89e3\u6790\n\n\u5728\u8bb2\u4e2d\u95f4\u4ef6\u4e4b\u524d\u6211\u4eec\u5148\u770b\u4e00\u4e0b redux \u63d0\u4f9b\u7ed9\u6211\u4eec\u7684\u4e00\u4e2a\u5de5\u5177\u51fd\u6570 compose\n\n```js\nexport default function compose(...funcs) {\n  if (funcs.length === 0) {\n    return (arg) => arg\n  }\n  if (funcs.length === 1) {\n    return funcs[0]\n  }\n  return funcs.reduce(\n    (a, b) =>\n      (...args) =>\n        a(b(...args))\n  )\n}\n```\n\n\u8fd9\u4e2a\u51fd\u6570\u6709\u4ec0\u4e48\u4f5c\u7528\u5462\uff0c\u8ba9\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u770b\u770b\n\n```js\n//   ./src/index7.jsx\nfunction compose(...funcs) {\n  if (funcs.length === 0) {\n    return (arg) => arg\n  }\n  if (funcs.length === 1) {\n    return funcs[0]\n  }\n  return funcs.reduce(\n    (a, b) =>\n      (...args) =>\n        a(b(...args))\n  )\n}\nfunction func1(arg) {\n  return arg + 1\n}\nfunction func2(arg) {\n  return arg + 1\n}\nfunction func3(arg) {\n  return arg + 1\n}\nconst res = func1(func2(func3(1)))\nconsole.log(res, 'res') // 4\nconst composeFun = compose(func1, func2, func3)\nconst res2 = composeFun(1)\nconsole.log(res2, 'res2') // 4\n```\n\n\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5c06 func1(func2(func3(1)))\u8fd9\u79cd\u683c\u5f0f\u8f6c\u6362\u6210\u4e86 compose(func1, func2, func3)(1)\uff0c\u8fd9\u79cd\u5199\u6cd5\u6709\u4e24\u4e2a\u4f18\u70b9\u3002\n\n- 1\u3001\u5c31\u662f\u9632\u6b62\u51fd\u6570\u5de6\u8fb9\u5316\uff0c\u4f7f\u4ee3\u7801\u66f4\u52a0\u6e05\u6670\n- 2\u3001\u5982\u679c\u6211\u4eec\u4e0d\u77e5\u9053\u6709\u591a\u5c11\u4e2a\u51fd\u6570\u5d4c\u5957\u8c03\u7528\u7684\u65f6\u5019\uff0c\u4f7f\u7528 compose \u5c31\u6bd4\u8f83\u65b9\u4fbf\u4e86\uff0c\u4f8b\u5982\u6211\u4eec\u5728\u4f7f\u7528 redux \u65f6\u53ef\u80fd\u4f1a\u4f20\u5165\u591a\u4e2a\u4e2d\u95f4\u4ef6\u51fd\u6570\uff0ccompose \u53ef\u4ee5\u628a\u6240\u6709\u7684\u4e2d\u95f4\u4ef6\u5f53\u505a\u53c2\u6570\u4f20\u5165\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4e2d\u95f4\u4ef6\u7684\u5d4c\u5957\u4f7f\u7528\u4e86\n\n\u5728\u4ecb\u7ecd applyMiddleware \u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e00\u4e0b\u4e2d\u95f4\u4ef6\u7684\u5fc3\u667a\u6a21\u578b\uff0credux \u5b98\u7f51[\u4e2d\u95f4\u4ef6\u7bc7](https://www.redux.org.cn/docs/advanced/Middleware.html)\u5c06\u5e26\u9886\u6211\u4eec\u4e00\u6b65\u4e00\u6b65\u7684\u7406\u89e3 Middleware\uff0c\u4ed6\u4f1a\u5e26\u9886\u4f60\u4ece\u7b80\u5355\u7684\u51fd\u6570\u5c01\u88c5\u5230\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u4e2d\u95f4\u4ef6\uff0c\u6211\u76f8\u4fe1\u5f53\u4f60\u8010\u5fc3\u770b\u5b8c\u8fd9\u8fb9\u6587\u7ae0\u4ee5\u540e\u4e00\u5b9a\u4f1a\u5bf9\u4e2d\u95f4\u4ef6\u6709\u4e86\u66f4\u52a0\u6df1\u523b\u7684\u7406\u89e3\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u6765\u770b\u4e00\u4e0b applyMiddleware \u662f\u600e\u6837\u5b9e\u73b0\u7684\u4e86\u3002\n\n\u6ce8\uff1a\u8fd9\u7bc7\u6587\u7ae0\u5199\u5f97\u7279\u522b\u597d\uff0c\u6ca1\u6709\u770b\u8fc7\u8fd9\u7bc7\u6587\u7ae0\u7684\u5c0f\u4f19\u4f34\u4e00\u5b9a\u8981\u591a\u7422\u78e8\u51e0\u904d\uff0c\u8fd9\u91cc\u518d\u63a8\u8350\u4e00\u4e0b Dan Abramov \u7684\u4e2a\u4eba[\u535a\u5ba2](https://overreacted.io/)\uff0c\u6bcf\u4e00\u7bc7\u90fd\u662f\u6ee1\u6ee1\u7684\u5e72\u8d27\uff08\u800c\u4e14\u5927\u90e8\u5206\u7bc7\u7ae0\u90fd\u6709\u4e2d\u6587\u7ffb\u8bd1\uff09\uff0c\u5176\u4e2d[useEffect \u5b8c\u6574\u6307\u5357](https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/)\u5b8c\u6574\u7684\u8bb2\u8ff0\u4e86\u51fd\u6570\u5f0f\u7ec4\u4ef6\u7684\u5fc3\u667a\u6a21\u578b\uff0c\u63a8\u8350\u5927\u5bb6\u9605\u8bfb\u4e00\u4e0b\n\n\u5728\u8bb2 applyMiddleware \u4e4b\u524d\u6211\u4eec\u5148\u770b\u4e00\u4e0b applyMiddleware \u662f\u5982\u4f55\u4f7f\u7528\u7684\n\n```js\n//    ./src/index8.jsx\nimport { createStore, applyMiddleware } from 'redux'\n/**\n * \u8bb0\u5f55\u6240\u6709\u88ab\u53d1\u8d77\u7684 action \u4ee5\u53ca\u4ea7\u751f\u7684\u65b0\u7684 state\u3002\u7684\u4e2d\u95f4\u4ef6\n * \u76f8\u4fe1\u5927\u5bb6\u5728\u8bfb\u5b8credux\u5b98\u7f51\u7684\u6587\u7ae0\u4ee5\u540e\u80af\u5b9a\u53ef\u4ee5\u7406\u89e3\u4e0b\u9762\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u51fd\u6570\n */\nconst logger = (store) => (next) => (action) => {\n  console.group(action.type)\n  console.info('dispatching', action)\n  let result = next(action)\n  console.log('next state', store.getState())\n  console.groupEnd(action.type)\n  return result\n}\nconst initState = {\n  num: 0,\n}\nfunction counter(state = initState, action) {\n  switch (action.type) {\n    case 'ADD_NUM1':\n      return { ...state, num: state.num + 1 }\n    default:\n      return state\n  }\n}\nconst store = createStore(counter, applyMiddleware(logger))\nstore.dispatch({ type: 'ADD_NUM1' })\nstore.dispatch({ type: 'ADD_NUM1' })\n```\n\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230 applyMiddleware(logger)\u662f\u5f53\u505a\u7b2c\u53c2\u6570\u4f20\u5165\u5230 createStore \u91cc\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u56de\u987e\u4e00\u4e0b createStore\n\n```js\n  createStore(reducer, preloadedState, enhancer) {\n    ...\n    ...\n    if (typeof enhancer !== 'undefined') {\n      if (typeof enhancer !== 'function') {\n        throw new Error('Expected the enhancer to be a function.')\n      }\n      // \u5173\u952e\u5728\u8fd9\u91cc\n      return enhancer(createStore)(reducer, preloadedState)\n    }\n    ...\n    ...\n  }\n```\n\nenhancer \u5c31\u662f\u6211\u4eec\u4f20\u5165 applyMiddleware(logger)\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u7684\u601d\u8def\u5c31\u662f\u770b\u4e00\u4e0b applyMiddleware(logger)\u8fd4\u56de\u503c\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u8981\u770b\u4e00\u4e0b applyMiddleware \u7684\u6e90\u7801\u662f\u600e\u6837\u5b9e\u73b0\u7684\u4e86\n\n```js\nimport compose from './compose'\n/**\n * \u63a5\u6536\u7684\u53c2\u6570\u5c31\u662f\u6211\u4eec\u4f20\u5165\u7684\u4e2d\u95f4\u4ef6\uff0c\u5e76\u4e14\u4f7f\u7528\u89e3\u6784\u8fd0\u7b97\u5c06\u4f20\u5165\u591a\u4e2a\u4e2d\u95f4\u4ef6\u8f6c\u6362\u4e3a\u6570\u7ec4\u7684\u5f62\u5f0f\n */\nexport default function applyMiddleware(...middlewares) {\n  // \u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u4e09\u7ea7\u7684\u67ef\u91cc\u5316\u51fd\u6570\n  // \u7b2c\u4e00\u7ea7\u51fd\u6570\u8c03\u7528\u5c31\u662fenhancer(createStore)\uff0c\u76f8\u5f53\u4e8e\u628a\u521b\u5efastore\u7684\u65b9\u6cd5\u4f20\u7ed9\u4e86applyMiddleware\n  // \u7b2c\u4e8c\u7ea7\u51fd\u6570\u8c03\u7528\u5c31\u662fenhancer(createStore)(reducer, preloadedState)\uff0c\u5c06reducer, preloadedState\u4f20\u7ed9applyMiddleware\n  return (createStore) =>\n    (...args) => {\n      // ...args\u5c31\u662freducer, preloadedState\uff0c\u8fd9\u91cc\u5c31\u76f8\u5f53\u4e8e\u521b\u5efa\u4e86\u4e00\u4e2astore\n      const store = createStore(...args)\n      let dispatch = () => {\n        throw new Error(\n          'Dispatching while constructing your middleware is not allowed. ' +\n            'Other middleware would not be applied to this dispatch.'\n        )\n      }\n      // \u8fd9\u91cc\u5c31\u662f\u6587\u6863\u91cc\u8bf4\u7684\uff1a\u5b83\u53ea\u66b4\u9732\u4e00\u4e2a store API \u7684\u5b50\u96c6\u7ed9 middleware\uff1adispatch(action) \u548c getState()\u3002\n      const middlewareAPI = {\n        getState: store.getState,\n        dispatch: (...args) => dispatch(...args),\n      }\n      /**\n       * \u8fd9\u662f\u6211\u4eec\u4f20\u5165\u7684\u4e2d\u95f4\u4ef6\n        const logger = store => next => action => {\n          console.group(action.type)\n          console.info('dispatching', action)\n          let result = next(action)\n          console.log('next state', store.getState())\n          console.groupEnd(action.type)\n          return result\n        }\n      */\n      const chain = middlewares.map((middleware) => middleware(middlewareAPI))\n      /**\n       * \u7ecf\u8fc7\u4e0a\u9762\u7684map\u904d\u5386\u8c03\u7528\u6bcf\u4e00\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u5f97\u5230\u7684chain\u5982\u4e0b\n       * chain = [\n           next => action => {\n            console.group(action.type)\n            console.info('dispatching', action)\n            let result = next(action)\n            console.log('next state', middlewareAPI.getState()) // \u8fd9\u91cc\u53d1\u751f\u4e86\u6539\u53d8\n            console.groupEnd(action.type)\n            return result\n          }\n       * ]\n      */\n      dispatch = compose(...chain)(store.dispatch)\n      /**\n       * compose(...chain)\u7684\u4f5c\u7528\u5c31\u662f\u5c06\u6211\u4eec\u4f20\u5165\u7684\u4e2d\u95f4\u4ef6\u5d4c\u5957\u8c03\u7528\uff0c\u4f5c\u7528\u662f\u4fdd\u8bc1\u6bcf\u4e00\u4e2a\u4e2d\u95f4\u7684\u7684\u4f20\u5165\u7684next\u53c2\u6570\u90fd\u662f\u4e0a\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u4fee\u6539\u540e\u7684dispatch\uff0c\u7531\u4e8e\u6211\u4eec\u8fd9\u91cc\u53ea\u4f20\u5165\u4e86\u4e00\u4e2a\u4e2d\u95f4\u4ef6\uff0ccompose(...chain)\u7ed3\u679c\u5c31\u662fchain[0]\n       * dispatch = \n          action => {\n            console.group(action.type)\n            console.info('dispatching', action)\n            let result = store.dispatch(action) // \u8fd9\u91cc\u53d1\u751f\u4e86\u6539\u53d8\n            console.log('next state', middlewareAPI.getState())\n            console.groupEnd(action.type)\n            return result\n          }\n      */\n      return {\n        ...store,\n        dispatch,\n      }\n      // \u6700\u540e\u5c06\u6539\u5199\u540e\u7684dispatch\u8fd4\u56de\n    }\n}\n```\n\napplyMiddleware \u7684\u6e90\u7801\u53ef\u8c13\u662f\u77ed\u5c0f\u7cbe\u608d\uff0c\u4f46\u662f\u60f3\u8981\u5f7b\u5e95\u7406\u89e3\u4ed6\u8fd8\u9700\u8981\u53cd\u590d\u7422\u78e8\n\n## 6\u3001redux-thunk \u7684\u4f7f\u7528\u548c\u89e3\u6790\n\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ccreateStore() \u6240\u521b\u5efa\u7684 Redux store \u6ca1\u6709\u4f7f\u7528 middleware\uff0c\u6240\u4ee5\u53ea\u652f\u6301 \u540c\u6b65\u6570\u636e\u6d41\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u5728 dispatch \u7684\u65f6\u5019\u53d1\u8d77\u5f02\u6b65\u8bf7\u6c42\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u50cf redux-thunk \u6216 redux-promise \u8fd9\u6837\u652f\u6301\u5f02\u6b65\u7684 middleware\uff0c\u6211\u4eec\u5148\u770b\u4e0b redux-thunk \u662f\u5982\u4f55\u4f7f\u7528\n\n```js\n//    ./src/index9.jsx\nimport { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nconst initState = {\n  num: 0,\n  data: null,\n}\nconst logger = (store) => (next) => (action) => {\n  console.group(action.type)\n  console.info('dispatching', action)\n  let result = next(action)\n  console.log('next state', store.getState())\n  console.groupEnd(action.type)\n  return result\n}\nfunction counter(state = initState, action) {\n  switch (action.type) {\n    case 'ADD_NUM1':\n      return { ...state, num: state.num + 1 }\n    case 'FETCH_DATA':\n      return { ...state, data: action.data }\n    default:\n      return state\n  }\n}\n// \u540c\u65f6\u4f7f\u7528\u4e86thunk\u548clogger\u4e24\u4e2a\u4e2d\u95f4\u4ef6\nconst store = createStore(counter, applyMiddleware(thunk, logger))\n// \u5f02\u6b65\u8bf7\u6c42\u6570\u636e\u7684\u65b9\u6cd5\nconst fetchData = () => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve('im asyncdata')\n    }, 2000)\n  })\n}\n// \u8fd9\u662f\u6211\u4eec\u8981\u6d3e\u53d1\u7684action\uff0c\u4f7f\u7528\u4e86redux-thunk\u4ee5\u540e\uff0caction\u4e66\u5199\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u5728\u51fd\u6570\u91cc\u9762dispatch action\nconst asyncData = () => {\n  return (dispatch) => {\n    fetchData().then((res) => {\n      dispatch({\n        type: 'FETCH_DATA',\n        data: res,\n      })\n    })\n  }\n}\nstore.dispatch({ type: 'ADD_NUM1' })\nstore.dispatch(asyncData())\n```\n\n\u4f7f\u7528\u4e86 redux-thunk \u4ee5\u540e\uff0c\u5f02\u6b65\u8bf7\u6c42\u6211\u4eec\u4e0d\u518d\u7b80\u5355\u7684 dispatch \u4e00\u4e2a\u5bf9\u8c61\uff0c\u800c\u662f dispatch \u4e00\u4e2a\u51fd\u6570\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u6210\u8fd9\u79cd\u53d8\u5316\u5462\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u770b redux-thunk \u5185\u90e8\u7a76\u7adf\u53d1\u751f\u4e86\u4ec0\u4e48\n\n```js\nfunction createThunkMiddleware(extraArgument) {\n  return ({ dispatch, getState }) =>\n    (next) =>\n    (action) => {\n      if (typeof action === 'function') {\n        return action(dispatch, getState, extraArgument)\n      }\n      return next(action)\n    }\n}\nconst thunk = createThunkMiddleware()\nthunk.withExtraArgument = createThunkMiddleware\nexport default thunk\n```\n\n\u719f\u6089\u4e86\u4e2d\u95f4\u4ef6\u4ee5\u540e\uff0c\u5176\u5b9e\u518d\u9605\u8bfb\u4e2d\u95f4\u4ef6\u5c31\u53d8\u5f97\u5f88\u5bb9\u6613\u4e86\uff0c\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u771f\u6b63\u5b9e\u73b0 redux-thunk \u7684\u529f\u80fd\u7684\u4ee3\u7801\u5c31\u4ee5\u4e0b\u8fd9\u4e2a\u51fd\u6570\n\n```js\n;(action) => {\n  if (typeof action === 'function') {\n    return action(dispatch, getState, extraArgument)\n  }\n  return next(action)\n}\n```\n\n\u5982\u679c dispatch \u7684\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u90a3\u4e48\u8fd8\u662f\u539f\u6765\u7684 dispatch\uff0c\u5982\u679c dispatch \u7684\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u90a3\u6211\u4eec\u5c31\u6267\u884c\u8fd9\u4e2a\u51fd\u6570\uff0c\u518d\u56de\u987e\u4e00\u4e0b\u6211\u4eec\u5199\u7684 asyncData \u8fd9\u4e2a\u51fd\u6570\uff0c\u6267\u884c\u4ed6\u7684\u8fd4\u56de\u503c\u7684\u7ed3\u679c\u5c31\u662f\u5728\u4e24\u79d2\u540e dispatch \u4e00\u4e2a\u666e\u901a\u7684 action\uff0c\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\u7684\u5b9e\u73b0\u4e86\u5f02\u6b65\u6570\u636e\u6d41\uff0c\u5176\u5b9e\u770b\u5230\u8fd9\u91cc\u6211\u4eec\u4e5f\u4f1a\u53d1\u73b0\uff0c\u5982\u679c\u4e0d\u5f15\u5165 redux-thunk \u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5df1\u624b\u52a8\u8c03\u7528 asyncData()(store.dispatch)\u6765\u53d1\u8d77\u5f02\u6b65\u8bf7\u6c42\uff0c\u53ea\u662f redux-thunk \u5e2e\u6211\u4eec\u4f18\u96c5\u7684\u505a\u4e86\u5904\u7406\uff0c\u5e76\u4e14\u901a\u8fc7 redux-thunk \u5904\u7406\uff0c\u8fd8\u53ef\u4ee5\u5b8c\u7f8e\u7684\u517c\u5bb9 bindActionCreators\n\n```js\n//    ./src/index10.jsx\nimport { createStore, applyMiddleware, bindActionCreators } from 'redux'\nimport thunk from 'redux-thunk'\nconst initState = {\n  num: 0,\n  data: null,\n}\nconst logger = (store) => (next) => (action) => {\n  console.group(action.type)\n  console.info('dispatching', action)\n  let result = next(action)\n  console.log('next state', store.getState())\n  console.groupEnd(action.type)\n  return result\n}\nfunction counter(state = initState, action) {\n  switch (action.type) {\n    case 'ADD_NUM1':\n      return { ...state, num: state.num + 1 }\n    case 'FETCH_DATA':\n      return { ...state, data: action.data }\n    default:\n      return state\n  }\n}\n// \u540c\u65f6\u4f7f\u7528\u4e86thunk\u548clogger\u4e24\u4e2a\u4e2d\u95f4\u4ef6\nconst store = createStore(counter, applyMiddleware(thunk, logger))\n// \u5f02\u6b65\u8bf7\u6c42\u6570\u636e\u7684\u65b9\u6cd5\nconst fetchData = () => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve('im asyncdata')\n    }, 2000)\n  })\n}\n// \u8fd9\u662f\u6211\u4eec\u8981\u6d3e\u53d1\u7684action\uff0c\u4f7f\u7528\u4e86redux-thunk\u4ee5\u540e\uff0caction\u4e66\u5199\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u5728\u51fd\u6570\u91cc\u9762dispatch action\nconst asyncData = () => {\n  return (dispatch) => {\n    fetchData().then((res) => {\n      dispatch({\n        type: 'FETCH_DATA',\n        data: res,\n      })\n    })\n  }\n}\nconst addNum1 = () => {\n  return {\n    type: 'ADD_NUM1',\n  }\n}\nconst boundActionCreators = bindActionCreators(\n  {\n    asyncData,\n    addNum1,\n  },\n  store.dispatch\n)\nconsole.log(boundActionCreators, 'boundActionCreators')\nboundActionCreators.asyncData()\nboundActionCreators.addNum1()\n```\n\n\u5230\u8fd9\u91cc\uff0c\u6574\u4e2a redux \u7684\u6e90\u7801\u89e3\u6790\u4e5f\u5c31\u5b8c\u6210\u4e86\u3002\n",pageInfo:{title:"Redux \u6e90\u7801\u89e3\u6790",subtitle:"Redux \u6e90\u7801\u89e3\u6790"}})}},8721:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/redux-source-code",function(){return t(7176)}])},3518:function(e){e.exports={imgPreview:"ImgPreview_imgPreview__2OxIp",visible:"ImgPreview_visible__37B3E"}},2472:function(e){e.exports={article:"post_article__2Kkhj",anchor:"post_anchor__3OJU8",translation:"post_translation__2cS_6"}}},function(e){e.O(0,[800,774,888,179],(function(){return n=8721,e(e.s=n);var n}));var n=e.O();_N_E=n}]);