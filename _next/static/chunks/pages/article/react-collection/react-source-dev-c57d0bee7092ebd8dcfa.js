(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[123],{8420:function(e,n,r){"use strict";r.d(n,{Z:function(){return h}});var t=r(6311),a=r(2472),c=r.n(a),s=r(9980),i=r.n(s),o=r(637),l=new(i())({highlight:function(e,n){var r=l.utils.escapeHtml(e);return n&&o.Z.getLanguage(n)&&(r=o.Z.highlight(n,e,!0).value),'<pre class="hljs"><code>'.concat(r,"</code></pre>")}}),u=l,d=r(2809),_=r(7294),p=r(3518),f=r.n(p),g=r(4184),v=r.n(g),m=r(5893),b=function(e){var n=e.visible,r=e.onClose,t=e.src;return(0,m.jsx)("div",{className:v()(f().imgPreview,(0,d.Z)({},f().visible,n)),onClick:r,children:(0,m.jsx)("img",{src:t})})},j=r(9008),h=(r(7460),function(e){var n=e.content,r=e.pageInfo,a=function(){var e=(0,_.useState)(!1),n=e[0],r=e[1],t=(0,_.useState)(""),a=t[0],c=t[1],s=(0,_.useRef)(null);return(0,_.useEffect)((function(){var e,n,t=null!==(e=null===(n=s.current)||void 0===n?void 0:n.getElementsByTagName("img"))&&void 0!==e?e:[];Array.from(t).forEach((function(e){e.onclick=function(e){e.target instanceof HTMLImageElement&&c(e.target.src),r(!0)}}))}),[]),[s,n,a,r]}(),s=(0,t.Z)(a,4),i=s[0],o=s[1],l=s[2],d=s[3];return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(j.default,{children:[(0,m.jsx)("title",{children:r.title}),(0,m.jsx)("meta",{name:"description",content:r.subtitle})]}),(0,m.jsx)(b,{visible:o,src:l,onClose:function(){return d(!1)}}),(0,m.jsx)("article",{ref:i,className:c().article,dangerouslySetInnerHTML:{__html:u.render(n)}})]})})},9506:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return c}});r(7294);var t=r(8420),a=r(5893),c=function(){return(0,a.jsx)(t.Z,{content:'# \u642d\u5efa React \u6e90\u7801\u8c03\u8bd5\u73af\u5883\n\n4 \u6708 12, 2022 \u2022 \u2615\ufe0f\u2615\ufe0f\u2615\ufe0f 20 min read\n\n\u5728\u9605\u8bfb react \u6e90\u7801\u7684\u65f6\u5019\uff0c\u76f8\u4fe1\u5927\u5bb6\u80af\u5b9a\u9047\u5230\u548c\u6211\u4e00\u6837\u7684\u56f0\u96be\uff0creact \u5185\u90e8\u6781\u6df1\u7684\u8c03\u7528\u6808\uff0c\u548c\u5230\u5904\u7684\u6570\u636e\u5f15\u7528\u7684\u4fee\u6539\u4f1a\u8ba9\u4f60\u611f\u5230\u5341\u5206\u6293\u72c2\uff0c\u800c\u5c06 react \u4ed3\u5e93 clone \u4e0b\u6765\u540e\uff0c\u8fde\u6210\u529f\u5b89\u88c5\u4f9d\u8d56\u90fd\u4e0d\u662f\u4e00\u4ef6\u5bb9\u6613\u7684\u4e8b\uff0c\u6240\u4ee5\u5728\u6211\u4eec\u51c6\u5907\u9605\u8bfb react \u524d\uff0c\u642d\u5efa\u4e00\u4e2a react \u6e90\u7801\u7684\u8c03\u8bd5\u73af\u5883\u662f\u5f88\u91cd\u8981\u7684\uff0c\u5728\u8e29\u4e86\u65e0\u6570\u7684\u5751\u4ee5\u540e\uff0c\u603b\u7ed3\u51fa\u4e86\u4ee5\u4e0b\u51e0\u6b65\u3002\n\n## \u521b\u5efa\u672c\u5730 dev server\n\n\u521b\u5efa\u672c\u5730\u7684 dev server \u6211\u4eec\u5c31\u7528\u6700\u7b80\u5355\u7684 create-react-app \u5373\u53ef\uff0c\u65b9\u4fbf\u5feb\u6377\u3002\n\n```js\n  npx create-react-app react-source-debug\n  cd react-source-debug\n  npm start\n```\n\n\u901a\u8fc7\u4e0a\u8ff0\u4e09\u884c\u547d\u4ee4\uff0c\u6211\u4eec\u5df2\u7ecf\u5f97\u5230\u4e86\u4e00\u4e2a react \u7684\u5e94\u7528\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5c06 node_modules \u91cc\u7684 react \u548c react-dom \u66ff\u6362\u4e3a\u53ef\u4ee5\u8c03\u8bd5\u7684\u6e90\u4ee3\u7801\u3002\u9996\u5148\u6211\u4eec\u5c06 webpack \u7684\u914d\u7f6e\u66b4\u9732\u51fa\u6765\uff0c\u65b9\u4fbf\u6211\u4eec\u540e\u7eed\u7684\u4fee\u6539\u3002\n\n```js\nnpm run eject\n```\n\n## \u4e0b\u8f7d react \u6e90\u4ee3\u7801\n\n\u51c6\u5907\u597d\u672c\u5730\u7684 dev server \u4ee5\u540e\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u5de5\u4f5c\u5c31\u662f\u5c06 react \u6e90\u7801\u5b89\u88c5\u5230\u6211\u4eec\u7684\u5e94\u7528\u91cc\u3002\u5f53\u524d\u6700\u65b0\u7684 react \u7248\u672c\u662f 18.0.0\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u53d6 [react18.0.0](https://github.com/facebook/react/tree/v18.0.0) \u8fd9\u4e2a tag \u4e0b\u7684\u4ee3\u7801\u3002\u4e0b\u8f7d\u4e0b\u6765\u4ee5\u540e\uff0c\u5c06 react \u6e90\u7801\u4e2d\u7684 package \u6587\u4ef6\u7684\u5185\u5bb9\u653e\u5230\u6211\u4eec\u7684 src \u6587\u4ef6\u5939\u4e0b\uff0c\u8fd9\u91cc\u6211\u65b9\u4fbf\u533a\u5206\uff0c\u5c06\u6587\u4ef6\u547d\u540d\u4e3a react-18.0.0\u3002\n\n![directory](/react-source-dev/directory.png)\n\n## \u4fee\u6539 webpack \u914d\u7f6e\n\n\u9996\u5148\u914d\u7f6e alias\uff0c\u901a\u8fc7\u914d\u7f6e\u522b\u540d\u6765\u5c06 react \u76f8\u5173\u7684\u5f15\u7528\u6307\u5411\u6211\u4eec\u8981\u8c03\u8bd5\u7684\u6e90\u7801\u3002\n\n```js\n// config/webpack.config.js\n// \u5c06\u539f\u6765alias\u7684\u914d\u7f6e\u66ff\u6362\u6210\u4e0b\u9762\u7684\nalias: {\n  "react-native": "react-native-web",\n  react: path.resolve(__dirname, "../src/react-18.0.0/react"),\n  "react-dom": path.resolve(__dirname, "../src/react-18.0.0/react-dom"),\n  "shared/ReactSharedInternals": path.resolve(\n    __dirname,\n    "../src/react-18.0.0/react/src/ReactSharedInternals"\n  ),\n  shared: path.resolve(__dirname, "../src/react-18.0.0/shared"),\n  "react-reconciler": path.resolve(\n    __dirname,\n    "../src/react-18.0.0/react-reconciler"\n  ),\n  scheduler: path.resolve(__dirname, "../src/react-18.0.0/scheduler"),\n  "./ReactFiberHostConfig": path.resolve(\n    __dirname,\n    "../src/react-18.0.0/react-reconciler/src/forks/ReactFiberHostConfig.dom"\n  ),\n}\n```\n\n\u8fd9\u91cc\u7b80\u5355\u89e3\u91ca\u4e00\u4e0b\uff0creact\u3001react-dom\u3001react-reconciler\u3001scheduler\u3001shared \u8fd9\u51e0\u4e2a\u8bbe\u7f6e\u522b\u540d\u5e94\u8be5\u90fd\u53ef\u4ee5\u7406\u89e3\uff0c\u81f3\u4e8e shared/ReactSharedInternals \u548c./ReactFiberHostConfig \u8fd9\u4e24\u4e2a\u662f\u4ec0\u4e48\u539f\u56e0\u5462\uff0c\u56e0\u4e3a react \u5185\u90e8\u5bf9\u8fd9\u4e24\u4e2a\u6587\u4ef6\u7684\u5f15\u7528\u5b9e\u9645\u4e0a\u662f\u65e0\u6548\u7684\uff0c\u800c\u662f\u5728\u6253\u5305\u7684\u65f6\u5019\u5bf9\u8fd9\u4e24\u4e2a\u8def\u5f84\u7279\u6b8a\u5904\u7406\uff0c\u4e5f\u662f\u901a\u8fc7\u7c7b\u4f3c\u522b\u540d\u7684\u65b9\u5f0f\u6765\u6362\u6210\u6b63\u786e\u7684\u8def\u5f84\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u4eff\u7167 react \u7684\u6253\u5305\u914d\u7f6e\uff0c\u4e3a\u8fd9\u4e24\u4e2a\u8def\u5f84\u4e5f\u8bbe\u7f6e\u4e0a\u522b\u540d\u3002\u8fd9\u91cc\u53ef\u4ee5\u6839\u636e\u8981\u8c03\u8bd5\u573a\u666f\u6765\u9009\u62e9 ./ReactFiberHostConfig \u5bf9\u5e94\u7684\u522b\u540d\uff0c\u6211\u7528\u7684\u662f ReactFiberHostConfig.dom\u3002\n\n![build](/react-source-dev/build.png)\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u7ee7\u7eed\u4fee\u6539\u73af\u5883\u53d8\u91cf\u3002\n\n```js\n// config/env.js\n// \u5c06\u539f\u6765\u7684stringified\u66ff\u6362\u4e3a\u4e0b\u9762\u7684\u3002\nconst stringified = {\n  __DEV__: false,\n  __PROFILE__: false,\n  __UMD__: true,\n  __EXPERIMENTAL__: true,\n  \'process.env\': Object.keys(raw).reduce((env, key) => {\n    env[key] = JSON.stringify(raw[key])\n    return env\n  }, {}),\n}\n```\n\n\u56e0\u4e3a react \u6e90\u7801\u91c7\u7528\u4e86 flow \u7684\u7c7b\u578b\u7cfb\u7edf\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u7f16\u8bd1 react \u6e90\u7801\u65f6\u9700\u8981\u989d\u5916\u6dfb\u52a0 flow \u7684 plugin\u3002\n\n```js\nnpm i @babel/plugin-transform-flow-strip-types -D\n```\n\n```js\n// config/webpack.config.js\n// \u6211\u4eec\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u627e\u5230 /\\.(js|mjs|jsx|ts|tsx)$/ \u5bf9\u5e94\u7684 babel-loader\uff0c\u6dfb\u52a0\u7f16\u8bd1 flow \u6240\u9700\u7684 plugin\n{\n  test: /\\.(js|mjs|jsx|ts|tsx)$/,\n  ...\n  options: {\n    ...\n    // \u5c06\u539f\u6765\u7684 plugin \u66f4\u6362\u4e3a\u4e0b\u65b9\u7684\n    plugins: [\n      require.resolve("@babel/plugin-transform-flow-strip-types"),\n      [\n        require.resolve("babel-plugin-named-asset-import"),\n        {\n          loaderMap: {\n            svg: {\n              ReactComponent:\n                "@svgr/webpack?-svgo,+titleProp,+ref![path]",\n            },\n          },\n        },\n      ],\n    ],\n    ...\n  },\n}\n```\n\n\u6267\u884c\u5230\u8fd9\u4e00\u6b65\uff0c\u57fa\u672c\u7684\u4e00\u4e2a\u8c03\u8bd5\u73af\u5883\u5df2\u7ecf\u642d\u5efa\u5b8c\u6210\uff0c\u6211\u4eec\u91cd\u65b0\u542f\u52a8\u4e00\u4e0b\u9879\u76ee\uff0c\u4e0d\u51fa\u610f\u5916\u7684\u8bdd\u4f60\u4f1a\u9047\u5230\u5f88\u591a\u62a5\u9519\uff0c\u8ba9\u6211\u4eec\u4e00\u6b65\u4e00\u6b65\u7684\u89e3\u51b3\u8fd9\u4e9b\u62a5\u9519\u3002\n\n## \u4fee\u6539 react \u548c react-dom \u7684\u5f15\u5165\u65b9\u5f0f\n\n```js\n// src/index.js\nimport React from \'react\'\nimport ReactDOM from \'react-dom\'\n// \u4fee\u6539\u4e3a\nimport * as React from \'react\'\nimport * as ReactDOM from \'react-dom\'\n```\n\n## \u5c4f\u853d eslint \u62a5\u9519\n\n\u5728\u9879\u76ee\u7684\u6839\u76ee\u5f55\u6dfb\u52a0 .vscode/settings.json \u6587\u4ef6\uff0c\u5c4f\u853d\u6389\u7f16\u8f91\u5668\u91cc\u7684\u7ea2\u6ce2\u6d6a\u7ebf\u3002\n\n```js\n{ "javascript.validate.enable": false, "typescript.validate.enable": false }\n```\n\n\u7136\u540e\u7981\u7528\u6389 webpack \u7684 eslint-loader \u6765\u907f\u514d\u7f16\u8bd1\u65f6\u7684\u62a5\u9519\u3002\n\n```js\n// config/webpack.config.js\n// \u5c06 disableESLintPlugin\u6539\u4e3atrue\n\nconst disableESLintPlugin = true\n```\n\n## \u4fee\u6539 react-reconciler/Scheduler.js\n\n```js\n// src/react-18.0.0/react-reconciler/src/Scheduler.js\n// \u8fd9\u4e24\u4e2a\u662freact\u5185\u90e8\u8c03\u8bd5\u65f6\u5019\u624d\u4f1a\u7528\u5230\u4e86\uff0c\u6211\u4eec\u6b63\u5e38\u4e0d\u4f1a\u4f7f\u7528\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3anull\u5373\u53ef\nexport const unstable_yieldValue = Scheduler.unstable_yieldValue\nexport const unstable_setDisableYieldValue = Scheduler.unstable_setDisableYieldValue\n// \u66ff\u6362\u4e3a\nexport const unstable_yieldValue = null\nexport const unstable_setDisableYieldValue = null\n```\n\n## \u4fee\u6539 jsxDEV\n\n```js\n// src/react-18.0.0/react/src/jsx/ReactJSX.js\nconst jsxDEV = __DEV__ ? jsxWithValidation : undefined\n// \u4fee\u6539\u4e3a\nconst jsxDEV = __DEV__ ? jsxWithValidation : jsxProd\n```\n\n\u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0b\uff0c\u56e0\u4e3a\u7f16\u8bd1 jsx \u9700\u8981\u4f7f\u7528\u7528\u5230 @babel/plugin-transform-react-jsx\uff0c\u800c\u5176\u5185\u90e8\u5b58\u5728\u5bf9 webpack \u73af\u5883\u7684\u5224\u65ad\uff0c\u56e0\u4e3a\u6211\u4eec\u901a\u8fc7 npm run start \u542f\u52a8\u7684\u73af\u5883\u53d8\u91cf\u662f development\uff0c\u6240\u4ee5\u8be5\u63d2\u4ef6\u5185\u90e8\u4f1a\u4f7f\u7528 jsxDEV \u6765\u5bf9 jsx \u8fdb\u884c\u7f16\u8bd1\u3002\u4f46\u662f\u6211\u4eec\u8c03\u8bd5 react \u6e90\u7801\u65f6\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\\_\\_DEV\\_\\_\u662f false\uff0c\u6240\u4ee5 react \u5185\u90e8\u662f\u751f\u4ea7\u73af\u5883\u3002\u8fd9\u6837\u4e24\u4e2a\u73af\u5883\u4ea7\u751f\u4e86\u51b2\u7a81\uff0c\u5bfc\u81f4 jsxDEV \u88ab\u8d4b\u503c\u4e3a undefined\uff0c\u8fd9\u91cc\u53ea\u9700\u8981\u6211\u4eec\u624b\u52a8\u5c06\u5176\u8bbe\u7f6e\u4e3a jsxProd \u5373\u53ef\u3002\n\n\u5230\u8fd9\u91cc\u6211\u4eec\u518d\u91cd\u65b0\u542f\u52a8\u4e0b\u9879\u76ee\uff0c\u770b\u5230\u5982\u4e0b\u9875\u9762\u5c31\u8bf4\u660e\u6211\u4eec\u5c31\u5927\u529f\u544a\u6210\u4e86\u3002\n\n![success](/react-source-dev/success.png)\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u53ef\u4ee5\u5220\u9664\u4e00\u4e9b\u4f5c\u7528\u4e0d\u5927\u7684\u6587\u4ef6\u6765\u51cf\u5c11\u6211\u4eec\u9879\u76ee\u7684\u4f53\u79ef\uff0c\u8fd9\u6b65\u6839\u636e\u81ea\u5df1\u7684\u573a\u666f\u6765\u5220\u9664\u5373\u53ef\uff0c\u8fd9\u91cc\u5df2\u7ecf\u642d\u5efa\u597d\u4e86\u4e00\u4e2a[\u8c03\u8bd5\u4ed3\u5e93](https://github.com/zlqxk/react-debug/tree/v18.0.0)\uff0c\u53ef\u4ee5\u76f4\u63a5 fork \u8fc7\u6765\u4f7f\u7528\u3002\u5728\u642d\u5efa\u597d react \u6e90\u7801\u8c03\u8bd5\u73af\u5883\u4ee5\u540e\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u6253\u65ad\u70b9\u8c03\u8bd5\uff0c\u901a\u8fc7\u65ad\u70b9\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u5230\u5f53\u524d\u4e0a\u4e0b\u6587\u7684\u53d8\u91cf\u3001\u5f15\u7528\u548c\u8c03\u7528\u5806\u6808\uff0c\u8fd9\u5bf9\u7406\u89e3\u6574\u4e2a react \u6267\u884c\u6d41\u7a0b\u6709\u5f88\u5927\u7684\u5e2e\u52a9\uff0c\u4e0b\u6587\u6211\u4eec\u7ee7\u7eed\u4ecb\u7ecd\u5982\u4f55\u5728 vscode \u4e2d\u65ad\u70b9\u8c03\u8bd5\u3002\n',pageInfo:{title:"\u642d\u5efa React \u6e90\u7801\u8c03\u8bd5\u73af\u5883",subtitle:"\u642d\u5efa React \u6e90\u7801\u8c03\u8bd5\u73af\u5883"}})}},8986:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/react-collection/react-source-dev",function(){return r(9506)}])},3518:function(e){e.exports={imgPreview:"ImgPreview_imgPreview__2OxIp",visible:"ImgPreview_visible__37B3E"}},2472:function(e){e.exports={article:"post_article__2Kkhj",anchor:"post_anchor__3OJU8",translation:"post_translation__2cS_6"}}},function(e){e.O(0,[800,774,888,179],(function(){return n=8986,e(e.s=n);var n}));var n=e.O();_N_E=n}]);